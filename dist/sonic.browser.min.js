!function(t){if("object"==typeof exports&&"undefined"!=typeof module)module.exports=t();else if("function"==typeof define&&define.amd)define([],t);else{var e;e="undefined"!=typeof window?window:"undefined"!=typeof global?global:"undefined"!=typeof self?self:this,e.Sonic=t()}}(function(){return function t(e,n,r){function i(o,a){if(!n[o]){if(!e[o]){var s="function"==typeof require&&require;if(!a&&s)return s(o,!0);if(u)return u(o,!0);var l=new Error("Cannot find module '"+o+"'");throw l.code="MODULE_NOT_FOUND",l}var f=n[o]={exports:{}};e[o][0].call(f.exports,function(t){var n=e[o][1][t];return i(n?n:t)},f,f.exports,t,e,n,r)}return n[o].exports}for(var u="function"==typeof require&&require,o=0;o<r.length;o++)i(r[o]);return i}({1:[function(t,e,n){var r=this.__extends||function(t,e){function n(){this.constructor=t}for(var r in e)e.hasOwnProperty(r)&&(t[r]=e[r]);n.prototype=e.prototype,t.prototype=new n},i=t("./observable"),u=t("./mutable_list"),o=function(t){function e(e){var n=this;void 0===e&&(e=[]),t.call(this),this.has=function(t){return null!=t&&t>-1&&t<n._array.length},this.get=function(t){return n.has(t)?n._array[t]:void 0},this.prev=function(t){return null==t&&n._array.length?n._array.length-1:n._array.length>0&&null!=t&&n.has(t)&&n.has(t-1)?t-1:null},this.next=function(t){return null==t&&n._array.length?0:n._array.length>0&&null!=t&&n.has(t)&&n.has(t+1)?t+1:null},this.set=function(t,e){return n.has(t)?void(n._array[t]=e):!1},this.splice=function(t,e){for(var r=[],i=2;i<arguments.length;i++)r[i-2]=arguments[i];if(null==t)t=-1;else if(!n.has(t))return!1;if(null==e)e=n._array.length;else if(!n.has(e))return!1;return(u=n._array).splice.apply(u,[t+1,e-t-1].concat(r)),n._invalidate(t,null),!0;var u},this.observe=function(t){return n._subject.observe(t)},this._invalidate=function(t,e){n.has(t)||(t=null),n.has(e)||(e=null),n._subject.notify(function(n){n.onInvalidate(t,e)})},this._subject=new i.Subject,this._array=e}return r(e,t),e}(u["default"]);n.ArrayList=o,n["default"]=o},{"./mutable_list":6,"./observable":7}],2:[function(t,e,n){function r(t){return o.MutableList.isMutableList(t)?o.MutableList.create(t):u.ObservableList.isObservableList(t)?u.ObservableList.create(t):i.List.isList(t)?i.List.create(t):Array.isArray(t)?new s["default"](t):a["default"].create(t)}var i=t("./list"),u=t("./observable_list"),o=t("./mutable_list"),a=t("./unit"),s=t("./array_list");n["default"]=r},{"./array_list":1,"./list":5,"./mutable_list":6,"./observable_list":8,"./unit":10}],3:[function(t,e,n){var r;!function(t){function e(t){return t.toString()}function n(){return r++}var r=0;t.key=e,t.create=n}(r||(r={})),n["default"]=r},{}],4:[function(t,e,n){var r=this.__extends||function(t,e){function n(){this.constructor=t}for(var r in e)e.hasOwnProperty(r)&&(t[r]=e[r]);n.prototype=e.prototype,t.prototype=new n},i=t("./id"),u=t("./observable"),o=t("./mutable_list"),a=function(t){function e(e){var n=this;t.call(this),this.has=function(t){return t in n._byId},this.get=function(t){return n._byId[t]},this.prev=function(t){void 0===t&&(t=null);var e=n._prev[t];return null==e?null:e},this.next=function(t){void 0===t&&(t=null);var e=n._next[t];return null==e?null:e},this.set=function(t,e){return n.has(t)?(n._byId[t]=e,n._invalidate(n._prev[t],n._next[t]),!0):!1},this.splice=function(t,e){void 0===t&&(t=null),void 0===e&&(e=null);for(var r=[],u=2;u<arguments.length;u++)r[u-2]=arguments[u];var o,a;for(o=t;null!=(o=n._next[o])&&(delete n._next[n._prev[o]],delete n._prev[o],o!=e);)delete n._byId[o];for(o=e;null!=(o=n._prev[o])&&(delete n._prev[n._next[o]],delete n._next[o],o!=t);)delete n._byId[o];for(var s=t,l=0;l<r.length;l++)a=r[l],o=i["default"].create(),n._byId[o]=a,n._prev[o]=s,n._next[s]=o,s=o;return n._prev[e]=s,n._next[s]=e,n._invalidate(t,e),!0},this.observe=function(t){return n._subject.observe(t)},this._invalidate=function(t,e){n.has(t)||(t=null),n.has(e)||(e=null),n._subject.notify(function(n){n.onInvalidate(t,e)})},this._subject=new u.Subject,this._byId=Object.create(null),this._prev=Object.create(null),this._next=Object.create(null),this._prev[null]=null,this._next[null]=null,this.splice.apply(this,[null,null].concat(e))}return r(e,t),e}(o["default"]);n["default"]=a},{"./id":3,"./mutable_list":6,"./observable":7}],5:[function(t,e,n){var r=t("./tree"),i=function(){function t(e){var n=this;this.has=function(t){throw new Error("Not implemented")},this.get=function(t){throw new Error("Not implemented")},this.prev=function(t){throw new Error("Not implemented")},this.next=function(t){throw new Error("Not implemented")},this.first=function(){return t.first(n)},this.last=function(){return t.last(n)},this.forEach=function(e){return t.forEach(n,e)},this.reduce=function(e,r){return t.reduce(n,e)},this.toArray=function(){return t.toArray(n)},this.findId=function(e){return t.findId(n,e)},this.find=function(e){return t.find(n,e)},this.idOf=function(e){return t.idOf(n,e)},this.indexOf=function(e){return t.indexOf(n,e)},this.idAt=function(e){return t.idAt(n,e)},this.at=function(e){return t.at(n,e)},this.every=function(e){return t.every(n,e)},this.some=function(e){return t.some(n,e)},this.contains=function(e){return t.contains(n,e)},this.reverse=function(){return t.create(t.reverse(n))},this.map=function(e){return t.create(t.map(n,e))},this.filter=function(e){return t.create(t.filter(n,e))},this.flatten=function(){return t.create(t.flatten(n))},this.flatMap=function(e){return t.create(t.flatMap(n,e))},this.cache=function(){return t.create(t.cache(n))},null!=e&&(this.has=e.has,this.get=e.get,this.prev=e.prev,this.next=e.next)}return t.isList=function(t){return!!(null!=t&&t.has&&t.get&&t.prev&&t.next)},t.create=function(e){return new t({has:e.has,get:e.get,prev:e.prev,next:e.next})},t.first=function(t){return t.get(t.next())},t.last=function(t){return t.get(t.prev())},t.forEach=function(t,e){for(var n;null!=(n=t.next(n));)e(t.get(n),n)},t.reduce=function(t,e,n){for(var r;null!=(r=t.next(r));)n=e(n,t.get(r),r);return n},t.toArray=function(e){return t.reduce(e,function(t,e){return t.push(e),t},[])},t.findId=function(t,e){for(var n;null!=(n=t.next(n));)if(e(t.get(n),n))return n},t.find=function(e,n){return e.get(t.findId(e,n))},t.idOf=function(e,n){return t.findId(e,function(t){return t===n})},t.indexOf=function(t,e){for(var n,r=0;null!=(n=t.next(n));){if(t.get(n)===e)return r;r++}},t.idAt=function(t,e){for(var n,r=0;null!=(n=t.next(n));)if(r++==e)return n;return null},t.at=function(e,n){return e.get(t.idAt(e,n))},t.every=function(t,e){for(var n;null!=(n=t.next(n));)if(!e(t.get(n),n))return!1;return!0},t.some=function(t,e){for(var n;null!=(n=t.next(n));)if(e(t.get(n),n))return!0;return!1},t.contains=function(e,n){return t.some(e,function(t){return t===n})},t.reverse=function(t){function e(e){return t.next(e)}function n(e){return t.prev(e)}var r=t.has,i=t.get;return{has:r,get:i,prev:e,next:n}},t.map=function(t,e){function n(n){return r(n)?e(t.get(n),n):void 0}var r=t.has,i=t.prev,u=t.next;return{has:r,get:n,prev:i,next:u}},t.filter=function(t,e){function n(n){return t.has(n)&&e(t.get(n),n)}function r(e){return n(e)?t.get(e):void 0}function i(e){for(var r=e;null!=(r=t.prev(r));)if(n(r))return r;return null}function u(e){for(var r=e;null!=(r=t.next(r));)if(n(r))return r;return null}return{has:n,get:r,prev:i,next:u}},t.flatten=function(t){function e(e){var n=r.Path.create(e);return r.Tree.has(t,n,1)}function n(e){var n=r.Path.create(e);return r.Tree.get(t,n,1)}function i(e){var n=r.Path.create(e);return r.Path.id(r.Tree.prev(t,n,1))}function u(e){var n=r.Path.create(e);return r.Path.id(r.Tree.next(t,n,1))}return{has:e,get:n,prev:i,next:u}},t.flatMap=function(e,n){return t.flatten(t.map(e,n))},t.cache=function(t){function e(e){return e in u||t.has(e)}function n(e){return e in u?u[e]:t.has(e)?u[e]=t.get(e):void 0}function r(e){if(e in a)return a[e];var n=t.prev(e);return null!=n&&(a[e]=n,o[n]=e),n}function i(e){if(e in o)return o[e];var n=t.next(e);return null!=n&&(o[e]=n,a[n]=e),n}var u=Object.create(null),o=Object.create(null),a=Object.create(null);return{has:e,get:n,prev:r,next:i}},t}();n.List=i,n["default"]=i},{"./tree":9}],6:[function(t,e,n){var r=this.__extends||function(t,e){function n(){this.constructor=t}for(var r in e)e.hasOwnProperty(r)&&(t[r]=e[r]);n.prototype=e.prototype,t.prototype=new n},i=t("./observable_list"),u=function(t){function e(n){var r=this;t.call(this,n),this.set=function(t,e){throw new Error("Not implemented")},this.splice=function(t,e){for(var n=[],r=2;r<arguments.length;r++)n[r-2]=arguments[r];throw new Error("Not implemented")},this.push=function(t){return e.push(r,t)},this.unshift=function(t){return e.unshift(r,t)},this.pop=function(){return e.pop(r)},this.shift=function(){return e.shift(r)},this["delete"]=function(t){return e["delete"](r,t)},this.remove=function(t){return e.remove(r,t)},null!=n&&(this.has=n.has,this.get=n.get,this.prev=n.prev,this.next=n.next,this.observe=n.observe,this.set=n.set,this.splice=n.splice)}return r(e,t),e.isMutableList=function(t){return i.ObservableList.isObservableList(t)&&!!t.set&&!!t.splice},e.create=function(t){return new e({has:t.has.bind(t),get:t.get.bind(t),prev:t.prev.bind(t),next:t.next.bind(t),observe:t.observe.bind(t),set:t.set.bind(t),splice:t.splice.bind(t)})},e.push=function(t,e){return t.splice(t.prev(),null,e),t.prev()},e.unshift=function(t,e){return t.splice(null,t.next(),e),t.next()},e.pop=function(t){var e=t.get(t.prev());return t.splice(t.prev(t.prev()),null),e},e.shift=function(t){var e=t.get(t.next());return t.splice(null,t.next(t.next())),e},e["delete"]=function(t,e){return t.has(e)?t.splice(t.prev(e),t.next(e)):!1},e.remove=function(t,n){var r=e.idOf(t,n);return delete r},e}(i.ObservableList);n.MutableList=u,n["default"]=u},{"./observable_list":8}],7:[function(t,e,n){var r=t("./id"),i=function(){function t(){var t=this;this.observe=function(e){var n=r["default"].create();return t._observers[n]=e,{unsubscribe:function(){delete t._observers[n]}}},this.notify=function(e){for(var n in t._observers)e(t._observers[n])},this._observers=Object.create(null)}return t}();n.Subject=i},{"./id":3}],8:[function(t,e,n){var r=this.__extends||function(t,e){function n(){this.constructor=t}for(var r in e)e.hasOwnProperty(r)&&(t[r]=e[r]);n.prototype=e.prototype,t.prototype=new n},i=t("./list"),u=t("./tree"),o=t("./observable"),a=function(t){function e(n){var r=this;t.call(this,n),this.observe=function(t){throw new Error("Not implemented")},this.reverse=function(){return e.create(e.reverse(r))},this.map=function(t){return e.create(e.map(r,t))},this.filter=function(t){return e.create(e.filter(r,t))},this.flatten=function(){return e.create(e.flatten(r))},this.flatMap=function(t){return e.create(e.flatMap(r,t))},this.cache=function(){return e.create(e.cache(r))},null!=n&&(this.observe=n.observe)}return r(e,t),e.isObservableList=function(t){return i.List.isList(t)&&!!t.observe},e.create=function(t){return new e({has:t.has.bind(t),get:t.get.bind(t),prev:t.prev.bind(t),next:t.next.bind(t),observe:t.observe.bind(t)})},e.reverse=function(t){function e(e){return t.observe(e)}var n=i.List.reverse(t),r=n.has,u=n.get,o=n.prev,a=n.next;return{has:r,get:u,prev:o,next:a,observe:e}},e.map=function(t,e){var n=i.List.map(t,e),r=n.has,u=n.get,o=n.prev,a=n.next;return{has:r,get:u,prev:o,next:a,observe:t.observe}},e.filter=function(t,e){function n(e){return t.observe({onInvalidate:function(t,n){t=u(t)?t:a(t),n=u(n)?n:s(n),e.onInvalidate(t,n)}})}var r=i.List.filter(t,e),u=r.has,o=r.get,a=r.prev,s=r.next;return{has:u,get:o,prev:a,next:s,observe:n}},e.flatten=function(t){var n,r=Object.create(null),a=new o.Subject;t.observe({onInvalidate:function(t,e){var i;for(i=t;null!=(i=n.next(i))&&i!=e;){var u=r[i];u&&(u.unsubscribe(),delete r[i])}for(i=e;null!=(i=n.prev(i))&&i!=t;){var u=r[i];u&&(u.unsubscribe(),delete r[i])}}}),n=e.cache(e.map(t,function(e,n){return r[n]=e.observe({onInvalidate:function(e,r){var i,o,s=u.Path.append(n,e),l=u.Path.append(n,r);null==e&&(s=u.Tree.prev(t,u.Tree.next(t,s))),null==r&&(l=u.Tree.next(t,u.Tree.prev(t,l))),i=u.Path.id(s),o=u.Path.id(l),a.notify(function(t){t.onInvalidate(i,o)})}}),e})),n.observe({onInvalidate:function(e,n){var r=u.Path.id(u.Tree.prev(t,[e])),i=u.Path.id(u.Tree.next(t,[n]));a.notify(function(t){t.onInvalidate(r,i)})}});var s=i.List.flatten(n),l=s.has,f=s.get,c=s.next,v=s.prev;return{has:l,get:f,next:c,prev:v,observe:a.observe}},e.flatMap=function(t,n){return e.flatten(e.map(t,n))},e.cache=function(t){function e(e){return e in u||t.has(e)}function n(e){return e in u?u[e]:t.has(e)?u[e]=t.get(e):void 0}function r(e){if(e in a)return a[e];var n=t.prev(e);return null!=n&&(a[e]=n,o[n]=e),n}function i(e){if(e in o)return o[e];var n=t.next(e);return null!=n&&(o[e]=n,a[n]=e),n}var u=Object.create(null),o=Object.create(null),a=Object.create(null);return t.observe({onInvalidate:function(t,e){var n;for(n=t;null!=(n=o[n])&&(delete o[a[n]],delete a[n],n!=e);)delete u[n];for(;null!=(n=a[n])&&(delete a[o[n]],delete o[n],n!=t);)delete u[n]}}),{has:e,get:n,prev:r,next:i,observe:t.observe}},e}(i.List);n.ObservableList=a,n["default"]=a},{"./list":5,"./observable":7,"./tree":9}],9:[function(t,e,n){var r,i=t("./list");!function(t){function e(t){return JSON.stringify(t)}function n(t){return null==t?null:JSON.parse(t.toString())}function r(t){return t?t[0]:null}function i(t,e){return t[e]}function u(t){return null==t?[]:t.slice(1,t.length)}function o(t,e){return[].concat(t).concat(e)}t.id=e,t.create=n,t.head=r,t.get=i,t.tail=u,t.append=o}(r=n.Path||(n.Path={}));var u;!function(t){function e(e,n,i){void 0===i&&(i=1/0);var u=r.head(n),o=r.tail(n);return e.has(u)&&(0==o.length||0==i||t.has(e.get(u),o,i))}function n(e,n,i){void 0===i&&(i=1/0);var u=r.head(n),o=r.tail(n);if(e.has(u)){var a=e.get(u);return 0==o.length||0==i?a:t.get(a,o,i)}}function u(e,n,u){void 0===n&&(n=[]),void 0===u&&(u=1/0);var o,a=r.head(n),s=r.tail(n),l=a;if(null==a||e.has(a))do if(o=e.get(l),i.List.isList(o)&&0!=u){var f=t.prev(o,s,u-1);if(null!=f)return r.append(l,f);s=[]}else if(null!=l&&l!=a)return[l];while(null!=(l=e.prev(l)))}function o(e,n,u){void 0===n&&(n=[]),void 0===u&&(u=1/0);var o,a=r.head(n),s=r.tail(n),l=a;if(null==a||e.has(a))do if(o=e.get(l),i.List.isList(o)&&0!=u){var f=t.next(o,s,u-1);if(null!=f)return r.append(l,f);s=[]}else if(null!=l&&l!=a)return[l];while(null!=(l=e.next(l)))}t.has=e,t.get=n,t.prev=u,t.next=o}(u=n.Tree||(n.Tree={}))},{"./list":5}],10:[function(t,e,n){var r=this.__extends||function(t,e){function n(){this.constructor=t}for(var r in e)e.hasOwnProperty(r)&&(t[r]=e[r]);n.prototype=e.prototype,t.prototype=new n},i=t("./id"),u=t("./observable"),o=t("./mutable_list"),a=function(t){function e(e){var n=this;t.call(this),this.has=function(t){return n._id==t},this.get=function(t){return n.has(t)?n._value:void 0},this.prev=function(t){return null==t?n._id:null},this.next=function(t){return null==t?n._id:null},this.set=function(t,e){return n._id=t,n._value=e,n._invalidate(),!0},this.splice=function(t,e){for(var r=[],u=2;u<arguments.length;u++)r[u-2]=arguments[u];return r.length?n.set(i["default"].create(),r[0]):(delete n._id,delete n._value,n._invalidate(),!0)},this.observe=function(t){return n._subject.observe(t)},this._invalidate=function(t,e){n._subject.notify(function(n){n.onInvalidate(t,e)})},this._subject=new u.Subject,arguments.length>2&&this.splice(null,null,e)}return r(e,t),e}(o["default"]);n.Unit=a,n["default"]=a},{"./id":3,"./mutable_list":6,"./observable":7}],11:[function(t,e,n){function r(t){return i["default"](t)}var i=t("./factory"),u=t("./list"),o=t("./observable_list"),a=t("./mutable_list"),s=t("./unit"),l=t("./array_list"),f=t("./linked_list"),c=t("./tree");r.List=u["default"],r.ObservableList=o["default"],r.MutableList=a["default"],r.Unit=s["default"],r.ArrayList=l["default"],r.LinkedList=f["default"],r.Tree=c.Tree,e.exports=r},{"./array_list":1,"./factory":2,"./linked_list":4,"./list":5,"./mutable_list":6,"./observable_list":8,"./tree":9,"./unit":10}]},{},[11])(11)});