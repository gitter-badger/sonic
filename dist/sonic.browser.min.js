!function(e){if("object"==typeof exports&&"undefined"!=typeof module)module.exports=e();else if("function"==typeof define&&define.amd)define([],e);else{var t;t="undefined"!=typeof window?window:"undefined"!=typeof global?global:"undefined"!=typeof self?self:this,t.Sonic=e()}}(function(){return function e(t,n,r){function u(o,l){if(!n[o]){if(!t[o]){var a="function"==typeof require&&require;if(!l&&a)return a(o,!0);if(i)return i(o,!0);var c=new Error("Cannot find module '"+o+"'");throw c.code="MODULE_NOT_FOUND",c}var f=n[o]={exports:{}};t[o][0].call(f.exports,function(e){var n=t[o][1][e];return u(n?n:e)},f,f.exports,e,t,n,r)}return n[o].exports}for(var i="function"==typeof require&&require,o=0;o<r.length;o++)u(r[o]);return u}({1:[function(e,t,n){"use strict";function r(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function u(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(e.__proto__=t)}Object.defineProperty(n,"__esModule",{value:!0});var i=function(e,t,n){for(var r=!0;r;){var u=e,i=t,o=n;l=c=a=void 0,r=!1;var l=Object.getOwnPropertyDescriptor(u,i);if(void 0!==l){if("value"in l)return l.value;var a=l.get;return void 0===a?void 0:a.call(o)}var c=Object.getPrototypeOf(u);if(null===c)return void 0;e=c,t=i,n=o,r=!0}},o=e("./observable_list"),l=e("./mutable_list"),a=function(e){function t(){var e=this,n=void 0===arguments[0]?[]:arguments[0];r(this,t),i(Object.getPrototypeOf(t.prototype),"constructor",this).call(this),this.get=function(t){return null!=t&&t>=0&&t<e._array.length?Promise.resolve(e._array[t]):Promise.reject(new Error)},this.prev=function(t){return null==t?Promise.resolve(e._array.length?e._array.length-1:null):0==t?Promise.resolve(null):t-1>=0&&t<e._array.length?Promise.resolve(t-1):void Promise.reject(new Error)},this.next=function(t){return null==t?Promise.resolve(e._array.length?0:null):t==e._array.length-1?Promise.resolve(null):t>=0&&t+1<e._array.length?Promise.resolve(t+1):void Promise.reject(new Error)},this.set=function(t,n){return e.splice(t>0?t-1:null,t<e._array.length-1?t+1:null,n)},this.splice=function(t,n){for(var r=arguments.length,u=Array(r>2?r-2:0),i=2;r>i;i++)u[i-2]=arguments[i];var o;return null!=t&&(0>t||t>=e._array.length)?Promise.reject(new Error):null!=t&&(0>n||n>=e._array.length)?Promise.reject(new Error):((o=e._array).splice.apply(o,[null==t?0:t+1,(null==n?e._array.length:n)-(null==t?0:t+1)].concat(u)),e._subject.onInvalidate(t,null),Promise.resolve())},this.observe=function(t){return e._subject.observe(t)},this._subject=new o.ListSubject,this._array=n}return u(t,e),t}(l.MutableList);n["default"]=a,t.exports=n["default"]},{"./mutable_list":9,"./observable_list":13}],2:[function(e,t,n){"use strict";function r(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}Object.defineProperty(n,"__esModule",{value:!0});var u=function i(e){var t=this;r(this,i),this.get=function(e){return e in t._byKey?Promise.resolve(t._byKey[e]):t._list.get(e).then(function(n){return t._byKey[e]=n})},this.prev=function(e){return e in t._prev?Promise.resolve(t._prev[e]):t._list.prev(e).then(function(n){return t._prev[e]=n,t._next[n]=e,n})},this.next=function(){var e=void 0===arguments[0]?null:arguments[0];return e in t._next?Promise.resolve(t._next[e]):t._list.next(e).then(function(n){return t._next[e]=n,t._prev[n]=e,n})},this._byKey=Object.create(null),this._next=Object.create(null),this._prev=Object.create(null),this._list=e};n.Cache=u,n["default"]=u},{}],3:[function(e,t,n){"use strict";function r(e){return e&&e.__esModule?e:{"default":e}}function u(e){return a.MutableList.isMutableList(e)?a.MutableList.create(e):l.ObservableList.isObservableList(e)?l.ObservableList.create(e):o.List.isList(e)?o.List.create(e):Array.isArray(e)?new v["default"](e):f["default"].create(e)}function i(e){var t=new f["default"];return e.then(function(e){t.push(e)}),l.ObservableList.create(t)}Object.defineProperty(n,"__esModule",{value:!0}),n["default"]=u,n.fromPromise=i;var o=e("./list"),l=e("./observable_list"),a=e("./mutable_list"),c=e("./unit"),f=r(c),s=e("./array_list"),v=r(s)},{"./array_list":1,"./list":7,"./mutable_list":9,"./observable_list":13,"./unit":15}],4:[function(e,t,n){"use strict";function r(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}Object.defineProperty(n,"__esModule",{value:!0});var u=e("./list"),i=function o(e){var t=this;r(this,o),this._add=function(e,n){t._byIndex[n]=e},this.get=function(e){return e>=0&&e<t._byIndex.length?t._list.get(t._byIndex[e]):u.List.find(t,function(t,n){return n===e},t._byIndex.length-1)},this.prev=function(e){return null!=e&&e>=0&&e<t._byIndex.length?Promise.resolve(0>e-1?null:e-1):u.List.some(t,function(t,n){return n===e-1},t._byIndex.length-1).then(function(n){if(n)return e-1;if(null==e)return t._byIndex.length-1;throw new Error})},this.next=function(e){var n=null==e?0:e+1;return n<t._byIndex.length?Promise.resolve(n):u.List.some(t._list,function(e,r){return t._add(r,t._byIndex.length),n===t._byIndex.length-1},t._byIndex[t._byIndex.length-1]).then(function(e){if(e)return n;if(n===t._byIndex.length)return null;throw new Error})},this._byIndex=[],this._list=e};n.Index=i,n["default"]=i},{"./list":7}],5:[function(e,t,n){"use strict";Object.defineProperty(n,"__esModule",{value:!0});var r;!function(e){function t(e){return e.toString()}function n(){return r++}var r=0;e.key=t,e.create=n}(r||(r={})),n["default"]=r,t.exports=n["default"]},{}],6:[function(e,t,n){"use strict";function r(e){return e&&e.__esModule?e:{"default":e}}function u(e){if(Array.isArray(e)){for(var t=0,n=Array(e.length);t<e.length;t++)n[t]=e[t];return n}return Array.from(e)}function i(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function o(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(e.__proto__=t)}Object.defineProperty(n,"__esModule",{value:!0});var l=function(e,t,n){for(var r=!0;r;){var u=e,i=t,o=n;l=c=a=void 0,r=!1;var l=Object.getOwnPropertyDescriptor(u,i);if(void 0!==l){if("value"in l)return l.value;var a=l.get;return void 0===a?void 0:a.call(o)}var c=Object.getPrototypeOf(u);if(null===c)return void 0;e=c,t=i,n=o,r=!0}},a=e("./key"),c=r(a),f=e("./observable_list"),s=e("./mutable_list"),v=function(e){function t(e,n){var r=this;i(this,t),l(Object.getPrototypeOf(t.prototype),"constructor",this).call(this),this._keyFn=c["default"].create,this.get=function(e){return e in r._byKey?Promise.resolve(r._byKey[e]):Promise.reject(new Error)},this.prev=function(){var e=void 0===arguments[0]?null:arguments[0];return e in r._prev?Promise.resolve(r._prev[e]):Promise.reject(new Error)},this.next=function(){var e=void 0===arguments[0]?null:arguments[0];return e in r._next?Promise.resolve(r._next[e]):Promise.reject(new Error)},this.set=function(e,t){return e in r._byKey?(r._byKey[e]=t,r._subject.onInvalidate(r._prev[e],r._next[e]),Promise.resolve()):Promise.reject(new Error)},this.splice=function(){for(var e=arguments.length,t=Array(e>2?e-2:0),n=2;e>n;n++)t[n-2]=arguments[n];for(var u,i=void 0===arguments[0]?null:arguments[0],o=void 0===arguments[1]?null:arguments[1],l=i;null!=(l=r._next[l])&&(delete r._next[r._prev[l]],delete r._prev[l],l!=o);)delete r._byKey[l];var a=o,c=!0,f=!1,s=void 0;try{for(var v,h=t[Symbol.iterator]();!(c=(v=h.next()).done);c=!0)u=v.value,l=r._keyFn(u),l in r._byKey&&r.splice(r._prev[l],r._next[l]),r._byKey[l]=u,r._prev[l]=a,r._next[a]=l,a=l}catch(p){f=!0,s=p}finally{try{!c&&h["return"]&&h["return"]()}finally{if(f)throw s}}return r._prev[o]=a,r._next[a]=o,r._subject.onInvalidate(i,o),Promise.resolve()},this.observe=function(e){return r._subject.observe(e)},n&&(this._keyFn=n),this._subject=new f.ListSubject,this._byKey=Object.create(null),this._prev=Object.create(null),this._next=Object.create(null),this._prev[null]=null,this._next[null]=null,this.splice.apply(this,[null,null].concat(u(e)))}return o(t,e),t}(s.MutableList);n["default"]=v,t.exports=n["default"]},{"./key":5,"./mutable_list":9,"./observable_list":13}],7:[function(e,t,n){"use strict";function r(e){return e&&e.__esModule?e:{"default":e}}function u(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}Object.defineProperty(n,"__esModule",{value:!0});var i=function(){function e(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}return function(t,n,r){return n&&e(t.prototype,n),r&&e(t,r),t}}(),o=e("./tree"),l=e("./cache"),a=r(l),c=e("./index"),f=r(c),s=function(){function e(t){var n=this;u(this,e),this.get=function(e){throw new Error("Not implemented")},this.prev=function(e){throw new Error("Not implemented")},this.next=function(e){throw new Error("Not implemented")},this.first=function(){return e.first(n)},this.last=function(){return e.last(n)},this.every=function(t){return e.every(n,t)},this.some=function(t){return e.some(n,t)},this.forEach=function(t){return e.forEach(n,t)},this.reduce=function(t,r){return e.reduce(n,t)},this.toArray=function(){return e.toArray(n)},this.findKey=function(t){return e.findKey(n,t)},this.find=function(t){return e.find(n,t)},this.keyOf=function(t){return e.keyOf(n,t)},this.indexOf=function(t){return e.indexOf(n,t)},this.keyAt=function(t){return e.keyAt(n,t)},this.at=function(t){return e.at(n,t)},this.contains=function(t){return e.contains(n,t)},this.reverse=function(){return e.create(e.reverse(n))},this.map=function(t){return e.create(e.map(n,t))},this.filter=function(t){return e.create(e.filter(n,t))},this.flatten=function(){return e.create(e.flatten(n))},this.flatMap=function(t){return e.create(e.flatMap(n,t))},this.cache=function(){return e.create(e.cache(n))},this.group=function(t){return e.create(e.group(n,t)).map(e.create).cache()},this.index=function(){return e.create(e.index(n))},this.zip=function(t,r){return e.create(e.zip(n,t,r))},this.skip=function(t){return e.create(e.skip(n,t))},this.take=function(t){return e.create(e.take(n,t))},this.range=function(t,r){return e.create(e.range(n,t,r))},this.scan=function(t,r){return e.create(e.scan(n,t,r))},null!=t&&(this.get=t.get,this.prev=t.prev,this.next=t.next)}return i(e,null,[{key:"isList",value:function(e){return null!=e&&!!e.get&&!!e.prev&&!!e.next}},{key:"create",value:function(t){return new e({get:t.get,prev:t.prev,next:t.next})}},{key:"first",value:function(e){return e.next().then(e.get)}},{key:"last",value:function(e){return e.prev().then(e.get)}},{key:"every",value:function(e,t,n,r){var u=function i(n){return e.next(n).then(function(n){return n==r?!0:e.get(n).then(function(e){return t(e,n)===!0?i(n):!1})})};return u(n)}},{key:"some",value:function(e,t,n,r){var u=function i(n){return e.next(n).then(function(n){return n==r?!1:e.get(n).then(function(e){return Promise.resolve(t(e,n)).then(function(e){return e===!0?!0:i(n)})})})};return u(n)}},{key:"forEach",value:function(t,n,r,u){return e.every(t,function(e,t){return n(e,t),!0},r,u).then(function(){})}},{key:"reduce",value:function(t,n,r){return e.forEach(t,function(e,t){return r=n(r,e,t)}).then(function(){return r})}},{key:"toArray",value:function(t){return e.reduce(t,function(e,t){return e.push(t),e},[])}},{key:"findKey",value:function(t,n,r,u){var i;return e.some(t,function(e,t){return Promise.resolve(n(e,t)).then(function(e){return e?!!(i=t)||!0:!1})},r,u).then(function(e){return e?i:null})}},{key:"find",value:function(t,n,r,u){return e.findKey(t,n,r,u).then(t.get)}},{key:"keyOf",value:function(t,n,r,u){return e.findKey(t,function(e){return e===n},r,u)}},{key:"indexOf",value:function(t,n,r,u){var i=-1;return e.some(t,function(e,t){return n==e?!!i++||!0:!1},r,u).then(function(e){if(e)return i;throw new Error})}},{key:"keyAt",value:function(t,n,r,u){return e.findKey(t,function(){return 0===n--})}},{key:"at",value:function(t,n){return e.keyAt(t,n).then(t.get)}},{key:"contains",value:function(t,n){return e.some(t,function(e){return e===n})}},{key:"reverse",value:function(e){function t(t){return e.next(t)}function n(t){return e.prev(t)}var r=e.get;return{get:r,prev:t,next:n}}},{key:"map",value:function(e,t){function n(n){return e.get(n).then(t)}var r=e.prev,u=e.next;return{get:n,prev:r,next:u}}},{key:"filter",value:function(t,n){function r(e){return t.get(e).then(function(e){if(n(e))return e;throw new Error})}function u(r){return e.findKey(e.reverse(t),n,r)}function i(r){return e.findKey(t,n,r)}return{get:r,prev:u,next:i}}},{key:"flatten",value:function(e){function t(t){var n=o.Path.fromKey(t);return o.Tree.get(e,n,1)}function n(t){var n=o.Path.fromKey(t);return o.Tree.prev(e,n,1).then(o.Path.toKey)}function r(t){var n=o.Path.fromKey(t);return o.Tree.next(e,n,1).then(o.Path.toKey)}return{get:t,prev:n,next:r}}},{key:"flatMap",value:function(t,n){return e.flatten(e.map(t,n))}},{key:"cache",value:function(e){return new a["default"](e)}},{key:"group",value:function(t,n){function r(r){return e.findKey(t,function(e,t){return n(e,t)===r}).then(function(){return o[r]=e.filter(t,function(e,t){return r===n(e,t)})})}function u(r){return e.findKey(e.reverse(t),function(e,t){var u=n(e,t);return u!==r&&!o[u]}).then(function(e){return null==e?null:t.get(e).then(function(t){return n(t,e)})})}function i(r){return e.findKey(t,function(e,t){var u=n(e,t);return u!==r&&!o[u]}).then(function(e){return null==e?null:t.get(e).then(function(t){return n(t,e)})})}var o=Object.create(null);return new a["default"]({get:r,prev:u,next:i})}},{key:"index",value:function(e){return new f["default"](e)}},{key:"zip",value:function(t,n,r){function u(e){return t.get(e).then(function(t){return n.get(e).then(function(e){return r(t,e)})})}function i(e){return t.prev(e).then(function(){return n.prev(e)})}function o(e){return t.next(e).then(function(){return n.next(e)})}return t=e.index(t),n=e.index(n),{get:u,prev:i,next:o}}},{key:"skip",value:function(t,n){return e.filter(e.index(t),function(e,t){return t>=n})}},{key:"take",value:function(t,n){return e.filter(e.index(t),function(e,t){return n>t})}},{key:"range",value:function(t,n,r){return e.filter(e.index(t),function(e,t){return t>=n&&r+n>t})}},{key:"scan",value:function(t,n,r){function u(e){return i.prev(e).then(function(e){return null==e?r:i.get(e)}).then(function(r){return t.get(e).then(function(e){return n(r,e)})})}var i,o=t.prev,l=t.next;return i=e.cache({get:u,prev:o,next:l})}}]),e}();n.List=s,n["default"]=s},{"./cache":2,"./index":4,"./tree":14}],8:[function(e,t,n){"use strict";function r(e){return e&&e.__esModule?e:{"default":e}}function u(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function i(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(e.__proto__=t)}Object.defineProperty(n,"__esModule",{value:!0});var o=function(e,t,n){for(var r=!0;r;){var u=e,i=t,o=n;l=c=a=void 0,r=!1;var l=Object.getOwnPropertyDescriptor(u,i);if(void 0!==l){if("value"in l)return l.value;var a=l.get;return void 0===a?void 0:a.call(o)}var c=Object.getPrototypeOf(u);if(null===c)return void 0;e=c,t=i,n=o,r=!0}},l=e("./observable_cache"),a=r(l),c=function(e){function t(e){var n=this;u(this,t),o(Object.getPrototypeOf(t.prototype),"constructor",this).call(this,e),this.set=function(e,t){return n._list.set(e,t)},this.splice=function(e,t){for(var r=arguments.length,u=Array(r>2?r-2:0),i=2;r>i;i++)u[i-2]=arguments[i];var o;return(o=n._list).splice.apply(o,[e,t].concat(u))}}return i(t,e),t}(a["default"]);n.MutableCache=c,n["default"]=c},{"./observable_cache":11}],9:[function(e,t,n){"use strict";function r(e){return e&&e.__esModule?e:{"default":e}}function u(e,t){if(Array.isArray(e))return e;if(Symbol.iterator in Object(e)){var n=[],r=!0,u=!1,i=void 0;try{for(var o,l=e[Symbol.iterator]();!(r=(o=l.next()).done)&&(n.push(o.value),!t||n.length!==t);r=!0);}catch(a){u=!0,i=a}finally{try{!r&&l["return"]&&l["return"]()}finally{if(u)throw i}}return n}throw new TypeError("Invalid attempt to destructure non-iterable instance")}function i(e){if(Array.isArray(e)){for(var t=0,n=Array(e.length);t<e.length;t++)n[t]=e[t];return n}return Array.from(e)}function o(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function l(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(e.__proto__=t)}Object.defineProperty(n,"__esModule",{value:!0});var a=function(){function e(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}return function(t,n,r){return n&&e(t.prototype,n),r&&e(t,r),t}}(),c=function(e,t,n){for(var r=!0;r;){var u=e,i=t,o=n;l=c=a=void 0,r=!1;var l=Object.getOwnPropertyDescriptor(u,i);if(void 0!==l){if("value"in l)return l.value;var a=l.get;return void 0===a?void 0:a.call(o)}var c=Object.getPrototypeOf(u);if(null===c)return void 0;e=c,t=i,n=o,r=!0}},f=e("./observable_list"),s=e("./mutable_cache"),v=r(s),h=function(e){function t(e){var n=this;o(this,t),c(Object.getPrototypeOf(t.prototype),"constructor",this).call(this,e),this.set=function(e,t){throw new Error("Not implemented")},this.splice=function(e,t){for(var n=arguments.length,r=Array(n>2?n-2:0),u=2;n>u;u++)r[u-2]=arguments[u];throw new Error("Not implemented")},this.addBefore=function(e,r){return t.addBefore(n,e,r)},this.addAfter=function(e,r){return t.addAfter(n,e,r)},this.push=function(e){return t.push(n,e)},this.unshift=function(e){return t.unshift(n,e)},this["delete"]=function(e){return t["delete"](n,e)},this.deleteBefore=function(e){return t.deleteBefore(n,e)},this.deleteAfter=function(e){return t.deleteAfter(n,e)},this.pop=function(){return t.pop(n)},this.shift=function(){return t.shift(n)},this.remove=function(e){return t.remove(n,e)},this.cache=function(){return t.create(t.cache(n))},this.map=function(e,r){return t.create(t.map(n,e,r))},null!=e&&(this.set=e.set,this.splice=e.splice)}return l(t,e),a(t,null,[{key:"isMutableList",value:function(e){return f.ObservableList.isObservableList(e)&&!!e.set&&!!e.splice}},{key:"create",value:function(e){return new t({get:e.get,prev:e.prev,next:e.next,observe:e.observe,set:e.set,splice:e.splice})}},{key:"addBefore",value:function(e,t,n){return e.prev(t).then(function(r){return e.splice(r,t,n)}).then(function(){return e.prev(t)})}},{key:"addAfter",value:function(e,t,n){return e.next(t).then(function(r){return e.splice(t,r,n)}).then(function(){return e.next(t)})}},{key:"push",value:function(e,n){return t.addBefore(e,null,n)}},{key:"unshift",value:function(e,n){return t.addAfter(e,null,n)}},{key:"delete",value:function(e,t){return e.get(t).then(function(n){return Promise.all([e.prev(t),e.next(t)]).then(function(t){var n=u(t,2),r=n[0],i=n[1];return e.splice(r,i)}).then(function(){return n})})}},{key:"deleteBefore",value:function(e,n){return e.prev(n).then(function(n){return t["delete"](e,n)})}},{key:"deleteAfter",value:function(e,n){return e.next(n).then(function(n){return t["delete"](e,n)})}},{key:"pop",value:function(e){return t.deleteBefore(e,null)}},{key:"shift",value:function(e){return t.deleteAfter(e,null)}},{key:"remove",value:function(e,n){return t.keyOf(e,n).then(function(n){t["delete"](e,n)})}},{key:"cache",value:function(e){return new v["default"](e)}},{key:"map",value:function(e,t,n){function r(t,r){return e.set(t,n(r,t))}function u(t,r){for(var u=arguments.length,o=Array(u>2?u-2:0),l=2;u>l;l++)o[l-2]=arguments[l];return e.splice.apply(e,[t,r].concat(i(o.map(n))))}var o=f.ObservableList.map(e,t),l=o.get,a=o.prev,c=o.next,s=o.observe;return{get:l,prev:a,next:c,observe:s,set:r,splice:u}}}]),t}(f.ObservableList);n.MutableList=h,n["default"]=h},{"./mutable_cache":8,"./observable_list":13}],10:[function(e,t,n){"use strict";function r(e){return e&&e.__esModule?e:{"default":e}}function u(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}Object.defineProperty(n,"__esModule",{value:!0});var i=e("./key"),o=r(i),l=function a(){var e=this;u(this,a),this.observe=function(t){var n=o["default"].create();return e._observers[n]=t,{unsubscribe:function(){delete e._observers[n]}}},this.notify=function(t){for(var n in e._observers)t(e._observers[n])},this._observers=Object.create(null)};n.Subject=l},{"./key":5}],11:[function(e,t,n){"use strict";function r(e){return e&&e.__esModule?e:{"default":e}}function u(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function i(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(e.__proto__=t)}Object.defineProperty(n,"__esModule",{value:!0});var o=function(e,t,n){for(var r=!0;r;){var u=e,i=t,o=n;l=c=a=void 0,r=!1;var l=Object.getOwnPropertyDescriptor(u,i);if(void 0!==l){if("value"in l)return l.value;var a=l.get;return void 0===a?void 0:a.call(o)}var c=Object.getPrototypeOf(u);if(null===c)return void 0;e=c,t=i,n=o,r=!0}},l=e("./cache"),a=r(l),c=function(e){function t(e){var n=this;u(this,t),o(Object.getPrototypeOf(t.prototype),"constructor",this).call(this,e),this.observe=function(e){return n._list.observe(e)},this.onInvalidate=function(e,t){var r;for(r=e;void 0!==(r=n._next[r])&&(delete n._next[n._prev[r]],delete n._prev[r],r!=t);)delete n._byKey[r];for(r=t;void 0!==(r=n._prev[r])&&(delete n._prev[n._next[r]],delete n._next[r],r!=e);)delete n._byKey[r]},e.observe(this)}return i(t,e),t}(a["default"]);n.ObservableCache=c,n["default"]=c},{"./cache":2}],12:[function(e,t,n){"use strict";function r(e){return e&&e.__esModule?e:{"default":e}}function u(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function i(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(e.__proto__=t)}Object.defineProperty(n,"__esModule",{value:!0});var o=function(e,t,n){for(var r=!0;r;){var u=e,i=t,o=n;l=c=a=void 0,r=!1;var l=Object.getOwnPropertyDescriptor(u,i);if(void 0!==l){if("value"in l)return l.value;var a=l.get;return void 0===a?void 0:a.call(o)}var c=Object.getPrototypeOf(u);if(null===c)return void 0;e=c,t=i,n=o,r=!0}},l=e("./index"),a=r(l),c=e("./observable_list"),f=function(e){function t(e){var n=this;u(this,t),o(Object.getPrototypeOf(t.prototype),"constructor",this).call(this,e),this._add=function(e,t){n._byIndex[t]=e,n._byKey[e]=t},this.observe=function(e){return n._subject.observe(e)},this.onInvalidate=function(e,t){for(var r=n._byKey[e],u=n._byIndex.length,i=r;++i<u;)delete n._byKey[n._byIndex[i]];n._byIndex.splice(r+1),n._subject.onInvalidate(r,null)},this._byKey=Object.create(null),this._subject=new c.ListSubject,e.observe(this)}return i(t,e),t}(a["default"]);n.ObservableIndex=f,n["default"]=f},{"./index":4,"./observable_list":13}],13:[function(e,t,n){"use strict";function r(e){return e&&e.__esModule?e:{"default":e}}function u(e,t){if(Array.isArray(e))return e;if(Symbol.iterator in Object(e)){var n=[],r=!0,u=!1,i=void 0;try{for(var o,l=e[Symbol.iterator]();!(r=(o=l.next()).done)&&(n.push(o.value),!t||n.length!==t);r=!0);}catch(a){u=!0,i=a}finally{try{!r&&l["return"]&&l["return"]()}finally{if(u)throw i}}return n}throw new TypeError("Invalid attempt to destructure non-iterable instance")}function i(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function o(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(e.__proto__=t)}Object.defineProperty(n,"__esModule",{value:!0});var l=function(){function e(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}return function(t,n,r){return n&&e(t.prototype,n),r&&e(t,r),t}}(),a=function(e,t,n){for(var r=!0;r;){var u=e,i=t,o=n;l=c=a=void 0,r=!1;var l=Object.getOwnPropertyDescriptor(u,i);if(void 0!==l){if("value"in l)return l.value;var a=l.get;return void 0===a?void 0:a.call(o)}var c=Object.getPrototypeOf(u);if(null===c)return void 0;e=c,t=i,n=o,r=!0}},c=e("./list"),f=e("./tree"),s=e("./observable"),v=e("./observable_cache"),h=r(v),p=e("./observable_index"),y=r(p),d=function(e){function t(){for(var e=this,n=arguments.length,r=Array(n),u=0;n>u;u++)r[u]=arguments[u];i(this,t),a(Object.getPrototypeOf(t.prototype),"constructor",this).apply(this,r),this.onInvalidate=function(t,n){e.notify(function(e){e.onInvalidate(t,n)})}}return o(t,e),t}(s.Subject);n.ListSubject=d;var b=function(e){function t(e){var n=this;i(this,t),a(Object.getPrototypeOf(t.prototype),"constructor",this).call(this,e),this.observe=function(e){throw new Error("Not implemented")},this.reverse=function(){return t.create(t.reverse(n))},this.map=function(e){return t.create(t.map(n,e))},this.filter=function(e){return t.create(t.filter(n,e))},this.flatten=function(){return t.create(t.flatten(n))},this.flatMap=function(e){return t.create(t.flatMap(n,e))},this.cache=function(){return t.create(t.cache(n))},this.index=function(){return t.create(t.index(n))},this.zip=function(e,r){return t.create(t.zip(n,e,r))},this.skip=function(e){return t.create(t.skip(n,e))},this.take=function(e){return t.create(t.take(n,e))},this.range=function(e,r){return t.create(t.range(n,e,r))},this.scan=function(e,r){return t.create(t.scan(n,e,r))},null!=e&&(this.observe=e.observe)}return o(t,e),l(t,null,[{key:"isObservableList",value:function(e){return c.List.isList(e)&&!!e.observe}},{key:"create",value:function(e){return new t({get:e.get,prev:e.prev,next:e.next,observe:e.observe})}},{key:"reverse",value:function(e){function t(t){return e.observe({onInvalidate:function(e,n){t.onInvalidate(n,e)}})}var n=c.List.reverse(e),r=n.get,u=n.prev,i=n.next;return{get:r,prev:u,next:i,observe:t}}},{key:"map",value:function(e,t){var n=c.List.map(e,t),r=n.get,u=n.prev,i=n.next;return{get:r,prev:u,next:i,observe:e.observe}}},{key:"filter",value:function(e,t){var n=c.List.filter(e,t),r=n.get,u=n.prev,i=n.next,o=new d;return e.observe({onInvalidate:function(e,t){u(e).then(function(e){return i(t).then(function(t){return o.onInvalidate(e,t)})})}}),{get:r,prev:u,next:i,observe:o.observe}}},{key:"flatten",value:function(e){function t(t){var n=function(n,r){Promise.all([null==n?f.Tree.prev(e,[t]):f.Path.append(t,n),null==r?f.Tree.next(e,[t]):f.Path.append(t,r)]).then(function(e){var t=u(e,2),n=t[0],r=t[1];o.onInvalidate(f.Path.toKey(n),f.Path.toKey(r))})};return{onInvalidate:n}}function n(n){return i.prev(n).then(function(n){var r=f.Path.fromKey(n),u=f.Path.head(r);return null==u||l[u]||e.get(u).then(function(e){return l[u]=e.observe(t(u))}),n})}function r(n){return i.next(n).then(function(n){var r=f.Path.fromKey(n),u=f.Path.head(r);return null==u||l[u]||e.get(u).then(function(e){return l[u]=e.observe(t(u))}),n})}var i=c.List.flatten(e),o=new d,l=Object.create(null),a=new h["default"]({get:e.get,prev:e.prev,next:e.next,observe:function(e){return null}});return e.observe({onInvalidate:function(t,n){c.List.forEach(a,function(e,t){l[t]&&(l[t].unsubscribe(),delete l[t])},t,n),Promise.all([null==t?null:f.Tree.prev(e,[t,null],1),null==n?null:f.Tree.next(e,[n,null],1)]).then(function(e){var t=u(e,2),n=t[0],r=t[1];o.onInvalidate(f.Path.toKey(n),f.Path.toKey(r))}),a.onInvalidate(t,n)}}),{get:i.get,prev:n,next:r,observe:o.observe}}},{key:"flatMap",value:function(e,n){return t.flatten(t.map(e,n))}},{key:"cache",value:function(e){return new h["default"](e)}},{key:"index",value:function(e){return new y["default"](e)}},{key:"zip",value:function(e,n,r){function u(t){return e.get(t).then(function(e){return n.get(t).then(function(t){return r(e,t)})})}function i(t){return e.prev(t).then(function(){return n.prev(t)})}function o(t){return e.next(t).then(function(){return n.next(t)})}e=t.index(e),n=t.index(n);var l=new d;return e.observe(l),n.observe(l),{get:u,prev:i,next:o,observe:l.observe}}},{key:"skip",value:function(e,n){return t.filter(t.index(e),function(e,t){return t>=n})}},{key:"take",value:function(e,n){return t.filter(t.index(e),function(e,t){return n>t})}},{key:"range",value:function(e,n,r){return t.filter(t.index(e),function(e,t){return t>=n&&r+n>t})}},{key:"scan",value:function(e,n,r){function u(t){return o.prev(t).then(function(e){return null==e?r:o.get(e)}).then(function(r){return e.get(t).then(function(e){return n(r,e)})})}function i(t){return e.observe({onInvalidate:function(e,n){t.onInvalidate(e,null)}})}var o,l=e.prev,a=e.next;return o=t.cache({get:u,prev:l,next:a,observe:i})}}]),t}(c.List);n.ObservableList=b,n["default"]=b},{"./list":7,"./observable":10,"./observable_cache":11,"./observable_index":12,"./tree":14}],14:[function(e,t,n){"use strict";Object.defineProperty(n,"__esModule",{value:!0});var r,u=e("./list");n.Path=r,function(e){function t(e){return JSON.stringify(e)}function n(e){return null==e?null:JSON.parse(e.toString())}function r(e){return null==e?null:JSON.stringify(e)}function u(e){return e?e[0]:null}function i(e,t){return e[t]}function o(e){return null==e?[]:e.slice(1,e.length)}function l(e,t){return[].concat(e).concat(t)}e.key=t,e.fromKey=n,e.toKey=r,e.head=u,e.get=i,e.tail=o,e.append=l}(r||(n.Path=r={}));var i;n.Tree=i,function(e){function t(t,n){var u=void 0===arguments[2]?1/0:arguments[2],i=r.head(n),o=r.tail(n);return t.get(i).then(function(t){return 0==o.length||0==u?t:e.get(t,o,u)})}function n(t){var n=void 0===arguments[1]?[]:arguments[1],i=void 0===arguments[2]?1/0:arguments[2],o=r.head(n),l=r.tail(n);return(null==o||!l.length)&&i>0?t.prev(o).then(function(n){return null==n?null:t.get(n).then(function(t){return u.List.isList(t)?e.prev(t,null,i-1).then(function(e){return null==e?null:r.append(n,e)}):[n]})}):l.length&&i>0?t.get(o).then(function(t){return e.prev(t,l,i-1)}).then(function(n){return null!=n?r.append(o,n):t.prev(o).then(function(n){return null==n?null:t.get(n).then(function(t){return e.prev(t,null,i-1)}).then(function(e){return r.append(n,e)})})}):t.prev(o).then(function(e){return null!=e?[e]:null})}function i(t){var n=void 0===arguments[1]?[]:arguments[1],i=void 0===arguments[2]?1/0:arguments[2],o=r.head(n),l=r.tail(n);return(null==o||!l.length)&&i>0?t.next(o).then(function(n){return null==n?null:t.get(n).then(function(t){return u.List.isList(t)?e.next(t,null,i-1).then(function(e){return null==e?null:r.append(n,e)}):[n]})}):l.length&&i>0?t.get(o).then(function(t){return e.next(t,l,i-1)}).then(function(n){return null!=n?r.append(o,n):t.next(o).then(function(n){return null==n?null:t.get(n).then(function(t){return e.next(t,null,i-1)}).then(function(e){return r.append(n,e)})})}):t.next(o).then(function(e){return null!=e?[e]:null})}function o(e,n,r){var u=n.slice(0,n.length-1),i=n[n.length-1];return t(e,u).then(function(e){return e.set(i,r)})}function l(e,n,r){for(var u=arguments.length,i=Array(u>3?u-3:0),o=3;u>o;o++)i[o-3]=arguments[o];var l=n.slice(0,n.length-1),a=n[n.length-1],c=(r.slice(0,r.length-1),r[r.length-1]);return t(e,l).then(function(e){return e.splice.apply(e,[a,c].concat(i))})}e.get=t,e.prev=n,e.next=i,e.set=o,e.splice=l}(i||(n.Tree=i={})),n["default"]=i;

},{"./list":7}],15:[function(e,t,n){"use strict";function r(e){return e&&e.__esModule?e:{"default":e}}function u(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function i(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(e.__proto__=t)}Object.defineProperty(n,"__esModule",{value:!0});var o=function(e,t,n){for(var r=!0;r;){var u=e,i=t,o=n;l=c=a=void 0,r=!1;var l=Object.getOwnPropertyDescriptor(u,i);if(void 0!==l){if("value"in l)return l.value;var a=l.get;return void 0===a?void 0:a.call(o)}var c=Object.getPrototypeOf(u);if(null===c)return void 0;e=c,t=i,n=o,r=!0}},l=e("./key"),a=r(l),c=e("./observable_list"),f=e("./mutable_list"),s=function(e){function t(e){var n=this;u(this,t),o(Object.getPrototypeOf(t.prototype),"constructor",this).call(this),this.get=function(e){return e===n._key?Promise.resolve(n._value):void Promise.reject(new Error)},this.prev=function(e){return null==e?Promise.resolve(n._key):e===n._key?Promise.resolve(null):Promise.reject(new Error)},this.next=function(e){return null==e?Promise.resolve(n._key):e===n._key?Promise.resolve(null):Promise.reject(new Error)},this.set=function(e,t){return n._key=e,n._value=t,n._subject.onInvalidate(null,null),Promise.resolve()},this.splice=function(e,t){for(var r=arguments.length,u=Array(r>2?r-2:0),i=2;r>i;i++)u[i-2]=arguments[i];return u.length?n.set(a["default"].create(),u[0]):(delete n._key,delete n._value,n._subject.onInvalidate(null,null),Promise.resolve())},this.observe=function(e){return n._subject.observe(e)},this._subject=new c.ListSubject,arguments.length&&this.splice(null,null,e)}return i(t,e),t}(f.MutableList);n["default"]=s,t.exports=n["default"]},{"./key":5,"./mutable_list":9,"./observable_list":13}],16:[function(e,t,n){"use strict";function r(e){return e&&e.__esModule?e:{"default":e}}function u(e){return o["default"](e)}Object.defineProperty(n,"__esModule",{value:!0}),n.Sonic=u;var u,i=e("./factory"),o=r(i),l=e("./list"),a=r(l),c=e("./observable_list"),f=r(c),s=e("./mutable_list"),v=r(s),h=e("./unit"),p=r(h),y=e("./array_list"),d=r(y),b=e("./linked_list"),_=r(b),g=e("./tree");n.Sonic=u,function(e){e.List=a["default"],e.ObservableList=f["default"],e.MutableList=v["default"],e.Unit=p["default"],e.ArrayList=d["default"],e.LinkedList=_["default"],e.Tree=g.Tree,e.Path=g.Path,e.fromPromise=i.fromPromise}(u||(n.Sonic=n.Sonic=u={})),t.exports=u,n["default"]=u},{"./array_list":1,"./factory":3,"./linked_list":6,"./list":7,"./mutable_list":9,"./observable_list":13,"./tree":14,"./unit":15}]},{},[16])(16)});