!function(t){if("object"==typeof exports&&"undefined"!=typeof module)module.exports=t();else if("function"==typeof define&&define.amd)define([],t);else{var e;e="undefined"!=typeof window?window:"undefined"!=typeof global?global:"undefined"!=typeof self?self:this,e.Sonic=t()}}(function(){return function t(e,n,r){function i(o,s){if(!n[o]){if(!e[o]){var a="function"==typeof require&&require;if(!s&&a)return a(o,!0);if(u)return u(o,!0);var l=new Error("Cannot find module '"+o+"'");throw l.code="MODULE_NOT_FOUND",l}var f=n[o]={exports:{}};e[o][0].call(f.exports,function(t){var n=e[o][1][t];return i(n?n:t)},f,f.exports,t,e,n,r)}return n[o].exports}for(var u="function"==typeof require&&require,o=0;o<r.length;o++)i(r[o]);return i}({1:[function(t,e,n){var r=this.__extends||function(t,e){function n(){this.constructor=t}for(var r in e)e.hasOwnProperty(r)&&(t[r]=e[r]);n.prototype=e.prototype,t.prototype=new n},i=t("./observable"),u=t("./mutable_list"),o=function(t){function e(e){var n=this;void 0===e&&(e=[]),t.call(this),this.has=function(t){return null!=t&&t>-1&&t<n._array.length},this.get=function(t){return n.has(t)?n._array[t]:void 0},this.prev=function(t){return null==t&&n._array.length?n._array.length-1:n._array.length>0&&null!=t&&n.has(t)&&n.has(t-1)?t-1:null},this.next=function(t){return null==t&&n._array.length?0:n._array.length>0&&null!=t&&n.has(t)&&n.has(t+1)?t+1:null},this.set=function(t,e){return n.has(t)?(n._array[t]=e,t):null},this.splice=function(t,e){for(var r=[],i=2;i<arguments.length;i++)r[i-2]=arguments[i];if(null==t)t=-1;else if(!n.has(t))return;if(null==e)e=n._array.length;else if(!n.has(e))return;(u=n._array).splice.apply(u,[t+1,e-(t+1)].concat(r)),n._invalidate(t,null);var u},this.observe=function(t){return n._subject.observe(t)},this._invalidate=function(t,e){n.has(t)||(t=null),n.has(e)||(e=null),n._subject.notify(function(n){n.onInvalidate(t,e)})},this._subject=new i.Subject,this._array=e}return r(e,t),e}(u.MutableList);n["default"]=o},{"./mutable_list":7,"./observable":8}],2:[function(t,e,n){var r=function(){function t(t){this._byKey=Object.create(null),this._next=Object.create(null),this._prev=Object.create(null),this._list=t}return t.prototype.has=function(t){return t in this._byKey||this._list.has(t)},t.prototype.get=function(t){return t in this._byKey?this._byKey[t]:this._list.has(t)?this._byKey[t]=this._list.get(t):void 0},t.prototype.prev=function(t){if(t in this._prev)return this._prev[t];var e=this._list.prev(t);return null==e&&(e=null),this._prev[t]=e,this._next[e]=t,e},t.prototype.next=function(t){if(void 0===t&&(t=null),t in this._next)return this._next[t];var e=this._list.next(t);return null==e&&(e=null),this._next[t]=e,this._prev[e]=t,e},t}();n["default"]=r},{}],3:[function(t,e,n){function r(t){return o.MutableList.isMutableList(t)?o.MutableList.create(t):u.ObservableList.isObservableList(t)?u.ObservableList.create(t):i.List.isList(t)?i.List.create(t):Array.isArray(t)?new a["default"](t):s["default"].create(t)}var i=t("./list"),u=t("./observable_list"),o=t("./mutable_list"),s=t("./unit"),a=t("./array_list");n["default"]=r},{"./array_list":1,"./list":6,"./mutable_list":7,"./observable_list":10,"./unit":12}],4:[function(t,e,n){var r;!function(t){function e(t){return t.toString()}function n(){return r++}var r=0;t.key=e,t.create=n}(r||(r={})),n["default"]=r},{}],5:[function(t,e,n){var r=this.__extends||function(t,e){function n(){this.constructor=t}for(var r in e)e.hasOwnProperty(r)&&(t[r]=e[r]);n.prototype=e.prototype,t.prototype=new n},i=t("./key"),u=t("./observable"),o=t("./mutable_list"),s=function(t){function e(e){var n=this;t.call(this),this.has=function(t){return t in n._byKey},this.get=function(t){return n._byKey[t]},this.prev=function(t){void 0===t&&(t=null);var e=n._prev[t];return null==e?null:e},this.next=function(t){void 0===t&&(t=null);var e=n._next[t];return null==e?null:e},this.set=function(t,e){return n.has(t)?(n._byKey[t]=e,n._invalidate(n._prev[t],n._next[t]),t):null},this.splice=function(t,e){void 0===t&&(t=null),void 0===e&&(e=null);for(var r=[],u=2;u<arguments.length;u++)r[u-2]=arguments[u];var o,s;for(o=t;null!=(o=n._next[o])&&(delete n._next[n._prev[o]],delete n._prev[o],o!=e);)delete n._byKey[o];for(o=e;null!=(o=n._prev[o])&&(delete n._prev[n._next[o]],delete n._next[o],o!=t);)delete n._byKey[o];for(var a=t,l=0;l<r.length;l++)s=r[l],o=i["default"].create(),n._byKey[o]=s,n._prev[o]=a,n._next[a]=o,a=o;n._prev[e]=a,n._next[a]=e,n._invalidate(t,e)},this.observe=function(t){return n._subject.observe(t)},this._invalidate=function(t,e){n.has(t)||(t=null),n.has(e)||(e=null),n._subject.notify(function(n){n.onInvalidate(t,e)})},this._subject=new u.Subject,this._byKey=Object.create(null),this._prev=Object.create(null),this._next=Object.create(null),this._prev[null]=null,this._next[null]=null,this.splice.apply(this,[null,null].concat(e))}return r(e,t),e}(o.MutableList);n["default"]=s},{"./key":4,"./mutable_list":7,"./observable":8}],6:[function(t,e,n){var r=t("./tree"),i=t("./cache"),u=function(){function t(e){var n=this;this.has=function(t){throw new Error("Not implemented")},this.get=function(t){throw new Error("Not implemented")},this.prev=function(t){throw new Error("Not implemented")},this.next=function(t){throw new Error("Not implemented")},this.first=function(){return t.first(n)},this.last=function(){return t.last(n)},this.forEach=function(e){return t.forEach(n,e)},this.reduce=function(e,r){return t.reduce(n,e)},this.toArray=function(){return t.toArray(n)},this.findKey=function(e){return t.findKey(n,e)},this.find=function(e){return t.find(n,e)},this.keyOf=function(e){return t.keyOf(n,e)},this.indexOf=function(e){return t.indexOf(n,e)},this.keyAt=function(e){return t.keyAt(n,e)},this.at=function(e){return t.at(n,e)},this.every=function(e){return t.every(n,e)},this.some=function(e){return t.some(n,e)},this.contains=function(e){return t.contains(n,e)},this.reverse=function(){return t.create(t.reverse(n))},this.map=function(e){return t.create(t.map(n,e))},this.filter=function(e){return t.create(t.filter(n,e))},this.flatten=function(){return t.create(t.flatten(n))},this.flatMap=function(e){return t.create(t.flatMap(n,e))},this.cache=function(){return t.create(t.cache(n))},null!=e&&(this.has=e.has,this.get=e.get,this.prev=e.prev,this.next=e.next)}return t.isList=function(t){return!!(null!=t&&t.has&&t.get&&t.prev&&t.next)},t.create=function(e){return new t({has:e.has,get:e.get,prev:e.prev,next:e.next})},t.first=function(t){return t.get(t.next())},t.last=function(t){return t.get(t.prev())},t.forEach=function(t,e){for(var n;null!=(n=t.next(n));)e(t.get(n),n)},t.reduce=function(t,e,n){for(var r;null!=(r=t.next(r));)n=e(n,t.get(r),r);return n},t.toArray=function(e){return t.reduce(e,function(t,e){return t.push(e),t},[])},t.findKey=function(t,e){for(var n;null!=(n=t.next(n));)if(e(t.get(n),n))return n},t.find=function(e,n){return e.get(t.findKey(e,n))},t.keyOf=function(e,n){return t.findKey(e,function(t){return t===n})},t.indexOf=function(t,e){for(var n,r=0;null!=(n=t.next(n));){if(t.get(n)===e)return r;r++}},t.keyAt=function(t,e){for(var n,r=0;null!=(n=t.next(n));)if(r++==e)return n;return null},t.at=function(e,n){return e.get(t.keyAt(e,n))},t.every=function(t,e){for(var n;null!=(n=t.next(n));)if(!e(t.get(n),n))return!1;return!0},t.some=function(t,e){for(var n;null!=(n=t.next(n));)if(e(t.get(n),n))return!0;return!1},t.contains=function(e,n){return t.some(e,function(t){return t===n})},t.reverse=function(t){function e(e){return t.next(e)}function n(e){return t.prev(e)}var r=t.has,i=t.get;return{has:r,get:i,prev:e,next:n}},t.map=function(t,e){function n(n){return r(n)?e(t.get(n),n):void 0}var r=t.has,i=t.prev,u=t.next;return{has:r,get:n,prev:i,next:u}},t.filter=function(t,e){function n(n){return t.has(n)&&e(t.get(n),n)}function r(e){return n(e)?t.get(e):void 0}function i(e){for(var r=e;null!=(r=t.prev(r));)if(n(r))return r;return null}function u(e){for(var r=e;null!=(r=t.next(r));)if(n(r))return r;return null}return{has:n,get:r,prev:i,next:u}},t.flatten=function(t){function e(e){var n=r.Path.create(e);return r.Tree.has(t,n,1)}function n(e){var n=r.Path.create(e);return r.Tree.get(t,n,1)}function i(e){var n=r.Path.create(e);return r.Path.key(r.Tree.prev(t,n,1))}function u(e){var n=r.Path.create(e);return r.Path.key(r.Tree.next(t,n,1))}return{has:e,get:n,prev:i,next:u}},t.flatMap=function(e,n){return t.flatten(t.map(e,n))},t.cache=function(t){return new i["default"](t)},t}();n.List=u,n["default"]=u},{"./cache":2,"./tree":11}],7:[function(t,e,n){var r=this.__extends||function(t,e){function n(){this.constructor=t}for(var r in e)e.hasOwnProperty(r)&&(t[r]=e[r]);n.prototype=e.prototype,t.prototype=new n},i=t("./observable_list"),u=function(t){function e(n){var r=this;t.call(this,n),this.set=function(t,e){throw new Error("Not implemented")},this.splice=function(t,e){for(var n=[],r=2;r<arguments.length;r++)n[r-2]=arguments[r];throw new Error("Not implemented")},this.addBefore=function(t,n){return e.addBefore(r,t,n)},this.addAfter=function(t,n){return e.addAfter(r,t,n)},this.push=function(t){return e.push(r,t)},this.unshift=function(t){return e.unshift(r,t)},this["delete"]=function(t){return e["delete"](r,t)},this.deleteBefore=function(t){return e.deleteBefore(r,t)},this.deleteAfter=function(t){return e.deleteAfter(r,t)},this.pop=function(){return e.pop(r)},this.shift=function(){return e.shift(r)},this.remove=function(t){return e.remove(r,t)},null!=n&&(this.set=n.set,this.splice=n.splice)}return r(e,t),e.isMutableList=function(t){return i.ObservableList.isObservableList(t)&&!!t.set&&!!t.splice},e.create=function(t){return new e({has:t.has,get:t.get,prev:t.prev,next:t.next,observe:t.observe,set:t.set,splice:t.splice})},e.addBefore=function(t,e,n){return t.splice(t.prev(e),e,n),t.prev(e)},e.addAfter=function(t,e,n){return t.splice(e,t.next(e),n),t.next(e)},e.push=function(t,n){return e.addBefore(t,null,n)},e.unshift=function(t,n){return e.addAfter(t,null,n)},e["delete"]=function(t,e){if(t.has(e)){var n=t.get(e);return t.splice(t.prev(e),t.next(e)),n}},e.deleteBefore=function(t,n){return e["delete"](t,t.prev(n))},e.deleteAfter=function(t,n){return e["delete"](t,t.next(n))},e.pop=function(t){return e.deleteBefore(t,null)},e.shift=function(t){return e.deleteAfter(t,null)},e.remove=function(t,n){var r=e.keyOf(t,n);return null==r?!1:(delete r,!0)},e}(i.ObservableList);n.MutableList=u,n["default"]=u},{"./observable_list":10}],8:[function(t,e,n){var r=t("./key"),i=function(){function t(){var t=this;this.observe=function(e){var n=r["default"].create();return t._observers[n]=e,{unsubscribe:function(){delete t._observers[n]}}},this.notify=function(e){for(var n in t._observers)e(t._observers[n])},this._observers=Object.create(null)}return t}();n.Subject=i},{"./key":4}],9:[function(t,e,n){var r=this.__extends||function(t,e){function n(){this.constructor=t}for(var r in e)e.hasOwnProperty(r)&&(t[r]=e[r]);n.prototype=e.prototype,t.prototype=new n},i=t("./cache"),u=function(t){function e(e){var n=this;t.call(this,e),e.observe({onInvalidate:function(t,e){var r;for(r=t;void 0!==(r=n._next[r])&&(delete n._next[n._prev[r]],delete n._prev[r],r!=e);)delete n._byKey[r];for(;void 0!==(r=n._prev[r])&&(delete n._prev[n._next[r]],delete n._next[r],r!=t);)delete n._byKey[r]}})}return r(e,t),e.prototype.observe=function(t){return this._list.observe(t)},e}(i["default"]);n["default"]=u},{"./cache":2}],10:[function(t,e,n){var r=this.__extends||function(t,e){function n(){this.constructor=t}for(var r in e)e.hasOwnProperty(r)&&(t[r]=e[r]);n.prototype=e.prototype,t.prototype=new n},i=t("./list"),u=t("./tree"),o=t("./observable"),s=t("./observable_cache"),a=function(t){function e(n){var r=this;t.call(this,n),this.observe=function(t){throw new Error("Not implemented")},this.reverse=function(){return e.create(e.reverse(r))},this.map=function(t){return e.create(e.map(r,t))},this.filter=function(t){return e.create(e.filter(r,t))},this.flatten=function(){return e.create(e.flatten(r))},this.flatMap=function(t){return e.create(e.flatMap(r,t))},this.cache=function(){return e.create(e.cache(r))},null!=n&&(this.observe=n.observe)}return r(e,t),e.isObservableList=function(t){return i.List.isList(t)&&!!t.observe},e.create=function(t){return new e({has:t.has.bind(t),get:t.get.bind(t),prev:t.prev.bind(t),next:t.next.bind(t),observe:t.observe.bind(t)})},e.reverse=function(t){function e(e){return t.observe(e)}var n=i.List.reverse(t),r=n.has,u=n.get,o=n.prev,s=n.next;return{has:r,get:u,prev:o,next:s,observe:e}},e.map=function(t,e){var n=i.List.map(t,e),r=n.has,u=n.get,o=n.prev,s=n.next;return{has:r,get:u,prev:o,next:s,observe:t.observe}},e.filter=function(t,e){function n(e){return t.observe({onInvalidate:function(t,n){t=u(t)?t:s(t),n=u(n)?n:a(n),e.onInvalidate(t,n)}})}var r=i.List.filter(t,e),u=r.has,o=r.get,s=r.prev,a=r.next;return{has:u,get:o,prev:s,next:a,observe:n}},e.flatten=function(t){var n,r=Object.create(null),s=new o.Subject;t.observe({onInvalidate:function(t,e){var i;for(i=t;null!=(i=n.next(i))&&i!=e;){var u=r[i];u&&(u.unsubscribe(),delete r[i])}for(i=e;null!=(i=n.prev(i))&&i!=t;){var u=r[i];u&&(u.unsubscribe(),delete r[i])}}}),n=e.cache(e.map(t,function(e,n){return r[n]=e.observe({onInvalidate:function(e,r){var i,o,a=u.Path.append(n,e),l=u.Path.append(n,r);null==e&&(a=u.Tree.prev(t,u.Tree.next(t,a))),null==r&&(l=u.Tree.next(t,u.Tree.prev(t,l))),i=u.Path.key(a),o=u.Path.key(l),s.notify(function(t){t.onInvalidate(i,o)})}}),e})),n.observe({onInvalidate:function(e,n){var r=u.Path.key(u.Tree.prev(t,[e])),i=u.Path.key(u.Tree.next(t,[n]));s.notify(function(t){t.onInvalidate(r,i)})}});var a=i.List.flatten(n),l=a.has,f=a.get,c=a.next,h=a.prev;return{has:l,get:f,next:c,prev:h,observe:s.observe}},e.flatMap=function(t,n){return e.flatten(e.map(t,n))},e.cache=function(t){return new s["default"](t)},e}(i.List);n.ObservableList=a,n["default"]=a},{"./list":6,"./observable":8,"./observable_cache":9,"./tree":11}],11:[function(t,e,n){var r,i=t("./list");!function(t){function e(t){return JSON.stringify(t)}function n(t){return null==t?null:JSON.parse(t.toString())}function r(t){return t?t[0]:null}function i(t,e){return t[e]}function u(t){return null==t?[]:t.slice(1,t.length)}function o(t,e){return[].concat(t).concat(e)}t.key=e,t.create=n,t.head=r,t.get=i,t.tail=u,t.append=o}(r=n.Path||(n.Path={}));var u;!function(t){function e(e,n,i){void 0===i&&(i=1/0);var u=r.head(n),o=r.tail(n);return e.has(u)&&(0==o.length||0==i||t.has(e.get(u),o,i))}function n(e,n,i){void 0===i&&(i=1/0);var u=r.head(n),o=r.tail(n);if(e.has(u)){var s=e.get(u);return 0==o.length||0==i?s:t.get(s,o,i)}}function u(e,n,u){void 0===n&&(n=[]),void 0===u&&(u=1/0);var o,s=r.head(n),a=r.tail(n),l=s;if(null==s||e.has(s))do if(o=e.get(l),i.List.isList(o)&&0!=u){var f=t.prev(o,a,u-1);if(null!=f)return r.append(l,f);a=[]}else if(null!=l&&l!=s)return[l];while(null!=(l=e.prev(l)))}function o(e,n,u){void 0===n&&(n=[]),void 0===u&&(u=1/0);var o,s=r.head(n),a=r.tail(n),l=s;if(null==s||e.has(s))do if(o=e.get(l),i.List.isList(o)&&0!=u){var f=t.next(o,a,u-1);if(null!=f)return r.append(l,f);a=[]}else if(null!=l&&l!=s)return[l];while(null!=(l=e.next(l)))}t.has=e,t.get=n,t.prev=u,t.next=o}(u=n.Tree||(n.Tree={})),n["default"]=u},{"./list":6}],12:[function(t,e,n){var r=this.__extends||function(t,e){function n(){this.constructor=t}for(var r in e)e.hasOwnProperty(r)&&(t[r]=e[r]);n.prototype=e.prototype,t.prototype=new n},i=t("./key"),u=t("./observable"),o=t("./mutable_list"),s=function(t){function e(e){var n=this;t.call(this),this.has=function(t){return n._key==t},this.get=function(t){return n.has(t)?n._value:void 0},this.prev=function(t){return null==t?n._key:null},this.next=function(t){return null==t?n._key:null},this.set=function(t,e){n._key=t,n._value=e,n._invalidate()},this.splice=function(t,e){for(var r=[],u=2;u<arguments.length;u++)r[u-2]=arguments[u];return r.length?n.set(i["default"].create(),r[0]):(delete n._key,delete n._value,void n._invalidate())},this.observe=function(t){return n._subject.observe(t)},this._invalidate=function(t,e){n._subject.notify(function(n){n.onInvalidate(t,e)})},this._subject=new u.Subject,arguments.length&&this.splice(null,null,e)}return r(e,t),e}(o.MutableList);n["default"]=s},{"./key":4,"./mutable_list":7,"./observable":8}],13:[function(t,e,n){function r(t){return i["default"](t)}var r,i=t("./factory"),u=t("./list"),o=t("./observable_list"),s=t("./mutable_list"),a=t("./unit"),l=t("./array_list"),f=t("./linked_list"),c=t("./tree");!function(t){t.List=u["default"],t.ObservableList=o["default"],t.MutableList=s["default"],t.Unit=a["default"],t.ArrayList=l["default"],t.LinkedList=f["default"],t.Tree=c["default"]}(r||(r={})),e.exports=r},{"./array_list":1,"./factory":3,"./linked_list":5,"./list":6,"./mutable_list":7,"./observable_list":10,"./tree":11,"./unit":12}]},{},[13])(13)});