!function(t){if("object"==typeof exports&&"undefined"!=typeof module)module.exports=t();else if("function"==typeof define&&define.amd)define([],t);else{var e;e="undefined"!=typeof window?window:"undefined"!=typeof global?global:"undefined"!=typeof self?self:this,e.Sonic=t()}}(function(){return function t(e,n,r){function i(o,l){if(!n[o]){if(!e[o]){var a="function"==typeof require&&require;if(!l&&a)return a(o,!0);if(u)return u(o,!0);var s=new Error("Cannot find module '"+o+"'");throw s.code="MODULE_NOT_FOUND",s}var f=n[o]={exports:{}};e[o][0].call(f.exports,function(t){var n=e[o][1][t];return i(n?n:t)},f,f.exports,t,e,n,r)}return n[o].exports}for(var u="function"==typeof require&&require,o=0;o<r.length;o++)i(r[o]);return i}({1:[function(t,e,n){var r=this.__extends||function(t,e){function n(){this.constructor=t}for(var r in e)e.hasOwnProperty(r)&&(t[r]=e[r]);n.prototype=e.prototype,t.prototype=new n},i=t("./observable"),u=t("./mutable_list"),o=function(t){function e(e){var n=this;void 0===e&&(e=[]),t.call(this),this.has=function(t){return null!=t&&t>-1&&t<n._array.length},this.get=function(t){return n.has(t)?n._array[t]:void 0},this.prev=function(t){return null==t&&n._array.length?n._array.length-1:n._array.length>0&&null!=t&&n.has(t)&&n.has(t-1)?t-1:null},this.next=function(t){return null==t&&n._array.length?0:n._array.length>0&&null!=t&&n.has(t)&&n.has(t+1)?t+1:null},this.set=function(t,e){return n.has(t)?(n._array[t]=e,t):null},this.splice=function(t,e){for(var r=[],i=2;i<arguments.length;i++)r[i-2]=arguments[i];if(null==t)t=-1;else if(!n.has(t))return;if(null==e)e=n._array.length;else if(!n.has(e))return;(u=n._array).splice.apply(u,[t+1,e-t-1].concat(r)),n._invalidate(t,null);var u},this.observe=function(t){return n._subject.observe(t)},this._invalidate=function(t,e){n.has(t)||(t=null),n.has(e)||(e=null),n._subject.notify(function(n){n.onInvalidate(t,e)})},this._subject=new i.Subject,this._array=e}return r(e,t),e}(u["default"]);n.ArrayList=o,n["default"]=o},{"./mutable_list":6,"./observable":7}],2:[function(t,e,n){function r(t){return o.MutableList.isMutableList(t)?o.MutableList.create(t):u.ObservableList.isObservableList(t)?u.ObservableList.create(t):i.List.isList(t)?i.List.create(t):Array.isArray(t)?new a["default"](t):l["default"].create(t)}var i=t("./list"),u=t("./observable_list"),o=t("./mutable_list"),l=t("./unit"),a=t("./array_list");n["default"]=r},{"./array_list":1,"./list":5,"./mutable_list":6,"./observable_list":8,"./unit":10}],3:[function(t,e,n){var r;!function(t){function e(t){return t.toString()}function n(){return r++}var r=0;t.key=e,t.create=n}(r||(r={})),n["default"]=r},{}],4:[function(t,e,n){var r=this.__extends||function(t,e){function n(){this.constructor=t}for(var r in e)e.hasOwnProperty(r)&&(t[r]=e[r]);n.prototype=e.prototype,t.prototype=new n},i=t("./id"),u=t("./observable"),o=t("./mutable_list"),l=function(t){function e(e){var n=this;t.call(this),this.has=function(t){return t in n._byId},this.get=function(t){return n._byId[t]},this.prev=function(t){void 0===t&&(t=null);var e=n._prev[t];return null==e?null:e},this.next=function(t){void 0===t&&(t=null);var e=n._next[t];return null==e?null:e},this.set=function(t,e){return n.has(t)?(n._byId[t]=e,n._invalidate(n._prev[t],n._next[t]),t):null},this.splice=function(t,e){void 0===t&&(t=null),void 0===e&&(e=null);for(var r=[],u=2;u<arguments.length;u++)r[u-2]=arguments[u];var o,l;for(o=t;null!=(o=n._next[o])&&(delete n._next[n._prev[o]],delete n._prev[o],o!=e);)delete n._byId[o];for(o=e;null!=(o=n._prev[o])&&(delete n._prev[n._next[o]],delete n._next[o],o!=t);)delete n._byId[o];for(var a=t,s=0;s<r.length;s++)l=r[s],o=i["default"].create(),n._byId[o]=l,n._prev[o]=a,n._next[a]=o,a=o;n._prev[e]=a,n._next[a]=e,n._invalidate(t,e)},this.observe=function(t){return n._subject.observe(t)},this._invalidate=function(t,e){n.has(t)||(t=null),n.has(e)||(e=null),n._subject.notify(function(n){n.onInvalidate(t,e)})},this._subject=new u.Subject,this._byId=Object.create(null),this._prev=Object.create(null),this._next=Object.create(null),this._prev[null]=null,this._next[null]=null,this.splice.apply(this,[null,null].concat(e))}return r(e,t),e}(o["default"]);n["default"]=l},{"./id":3,"./mutable_list":6,"./observable":7}],5:[function(t,e,n){var r=t("./tree"),i=function(){function t(e){var n=this;this.has=function(t){throw new Error("Not implemented")},this.get=function(t){throw new Error("Not implemented")},this.prev=function(t){throw new Error("Not implemented")},this.next=function(t){throw new Error("Not implemented")},this.first=function(){return t.first(n)},this.last=function(){return t.last(n)},this.forEach=function(e){return t.forEach(n,e)},this.reduce=function(e,r){return t.reduce(n,e)},this.toArray=function(){return t.toArray(n)},this.findId=function(e){return t.findId(n,e)},this.find=function(e){return t.find(n,e)},this.idOf=function(e){return t.idOf(n,e)},this.indexOf=function(e){return t.indexOf(n,e)},this.idAt=function(e){return t.idAt(n,e)},this.at=function(e){return t.at(n,e)},this.every=function(e){return t.every(n,e)},this.some=function(e){return t.some(n,e)},this.contains=function(e){return t.contains(n,e)},this.reverse=function(){return t.create(t.reverse(n))},this.map=function(e){return t.create(t.map(n,e))},this.filter=function(e){return t.create(t.filter(n,e))},this.flatten=function(){return t.create(t.flatten(n))},this.flatMap=function(e){return t.create(t.flatMap(n,e))},this.cache=function(){return t.create(t.cache(n))},this.index=function(){return t.create(t.index(n))},this.zip=function(e,r){return t.create(t.zip(n,e,r))},null!=e&&(this.has=e.has,this.get=e.get,this.prev=e.prev,this.next=e.next)}return t.isList=function(t){return!!(null!=t&&t.has&&t.get&&t.prev&&t.next)},t.create=function(e){return new t({has:e.has,get:e.get,prev:e.prev,next:e.next})},t.first=function(t){return t.get(t.next())},t.last=function(t){return t.get(t.prev())},t.forEach=function(t,e){for(var n;null!=(n=t.next(n));)e(t.get(n),n)},t.reduce=function(t,e,n){for(var r;null!=(r=t.next(r));)n=e(n,t.get(r),r);return n},t.toArray=function(e){return t.reduce(e,function(t,e){return t.push(e),t},[])},t.findId=function(t,e){for(var n;null!=(n=t.next(n));)if(e(t.get(n),n))return n},t.find=function(e,n){return e.get(t.findId(e,n))},t.idOf=function(e,n){return t.findId(e,function(t){return t===n})},t.indexOf=function(t,e){for(var n,r=0;null!=(n=t.next(n));){if(t.get(n)===e)return r;r++}},t.idAt=function(t,e){for(var n,r=0;null!=(n=t.next(n));)if(r++==e)return n;return null},t.at=function(e,n){return e.get(t.idAt(e,n))},t.every=function(t,e){for(var n;null!=(n=t.next(n));)if(!e(t.get(n),n))return!1;return!0},t.some=function(t,e){for(var n;null!=(n=t.next(n));)if(e(t.get(n),n))return!0;return!1},t.contains=function(e,n){return t.some(e,function(t){return t===n})},t.reverse=function(t){function e(e){return t.next(e)}function n(e){return t.prev(e)}var r=t.has,i=t.get;return{has:r,get:i,prev:e,next:n}},t.map=function(t,e){function n(n){return r(n)?e(t.get(n),n):void 0}var r=t.has,i=t.prev,u=t.next;return{has:r,get:n,prev:i,next:u}},t.filter=function(t,e){function n(n){return t.has(n)&&e(t.get(n),n)}function r(e){return n(e)?t.get(e):void 0}function i(e){for(var r=e;null!=(r=t.prev(r));)if(n(r))return r;return null}function u(e){for(var r=e;null!=(r=t.next(r));)if(n(r))return r;return null}return{has:n,get:r,prev:i,next:u}},t.flatten=function(t){function e(e){var n=r.Path.create(e);return r.Tree.has(t,n,1)}function n(e){var n=r.Path.create(e);return r.Tree.get(t,n,1)}function i(e){var n=r.Path.create(e);return r.Path.id(r.Tree.prev(t,n,1))}function u(e){var n=r.Path.create(e);return r.Path.id(r.Tree.next(t,n,1))}return{has:e,get:n,prev:i,next:u}},t.flatMap=function(e,n){return t.flatten(t.map(e,n))},t.cache=function(t){function e(e){return e in u||t.has(e)}function n(e){return e in u?u[e]:t.has(e)?u[e]=t.get(e):void 0}function r(e){if(e in l)return l[e];var n=t.prev(e);return null!=n&&(l[e]=n,o[n]=e),n}function i(e){if(e in o)return o[e];var n=t.next(e);return null!=n&&(o[e]=n,l[n]=e),n}var u=Object.create(null),o=Object.create(null),l=Object.create(null);return{has:e,get:n,prev:r,next:i}},t.index=function(t){function e(t){if(t>=0&&t<u.length)return!0;for(var e=u.length-1;null!=(e=i(e));)if(e==t)return!0;return!1}function n(n){return e(n)?t.get(u[n]):void 0}function r(t){return e(t)?t?t-1:null:null==t?u.length?u.length-1:null:void 0}function i(e){if(null==e&&u.length)return 0;if(e>=0&&e<u.length-1)return e+1;for(var n,r=u.length?u[u.length-1]:null;null!=(r=t.next(r));){var n=u.push(r)-1;if(n==(null!=e?e+1:0))return n}return null}var u=[];return{has:e,get:n,prev:r,next:i}},t.zip=function(e,n,r){function i(t){return e.has(t)&&n.has(t)}function u(t){return i(t)?r(e.get(t),n.get(t)):void 0}function o(t){var r=e.prev(t);return null!=r&&r==n.prev(t)?r:null}function l(t){var r=e.next(t);return null!=r&&r==n.next(t)?r:null}return e=t.index(e),n=t.index(n),{has:i,get:u,prev:o,next:l}},t.skip=function(e,n){return t.filter(t.index(e),function(t,e){return e>=n})},t.take=function(e,n){return t.filter(t.index(e),function(t,e){return n>e})},t.range=function(e,n,r){return t.filter(t.index(e),function(t,e){return e>=n&&r+n>e})},t.scan=function(e,n,r){function i(t){if(e.has(t)){for(var r=s[t];t+1>=s.length;)s.push(r=n(r,e.get(t)));return s[t+1]}}var u=e=t.index(e),o=u.has,l=u.prev,a=u.next,s=[r];return{has:o,get:i,prev:l,next:a}},t}();n.List=i,n["default"]=i},{"./tree":9}],6:[function(t,e,n){var r=this.__extends||function(t,e){function n(){this.constructor=t}for(var r in e)e.hasOwnProperty(r)&&(t[r]=e[r]);n.prototype=e.prototype,t.prototype=new n},i=t("./observable_list"),u=function(t){function e(n){var r=this;t.call(this,n),this.set=function(t,e){throw new Error("Not implemented")},this.splice=function(t,e){for(var n=[],r=2;r<arguments.length;r++)n[r-2]=arguments[r];throw new Error("Not implemented")},this.addBefore=function(t,n){return e.addBefore(r,t,n)},this.addAfter=function(t,n){return e.addAfter(r,t,n)},this.push=function(t){return e.push(r,t)},this.unshift=function(t){return e.unshift(r,t)},this["delete"]=function(t){return e["delete"](r,t)},this.deleteBefore=function(t){return e.deleteBefore(r,t)},this.deleteAfter=function(t){return e.deleteAfter(r,t)},this.pop=function(){return e.pop(r)},this.shift=function(){return e.shift(r)},this.remove=function(t){return e.remove(r,t)},null!=n&&(this.has=n.has,this.get=n.get,this.prev=n.prev,this.next=n.next,this.observe=n.observe,this.set=n.set,this.splice=n.splice)}return r(e,t),e.isMutableList=function(t){return i.ObservableList.isObservableList(t)&&!!t.set&&!!t.splice},e.create=function(t){return new e({has:t.has,get:t.get,prev:t.prev,next:t.next,observe:t.observe,set:t.set,splice:t.splice})},e.addBefore=function(t,e,n){return t.splice(t.prev(e),e,n),t.prev(e)},e.addAfter=function(t,e,n){return t.splice(e,t.next(e),n),t.next(e)},e.push=function(t,n){return e.addAfter(t,null,n)},e.unshift=function(t,n){return e.addBefore(t,null,n)},e["delete"]=function(t,e){if(t.has(e)){var n=t.get(e);return t.splice(t.prev(e),t.next(e)),n}},e.deleteBefore=function(t,n){return e["delete"](t,t.prev(n))},e.deleteAfter=function(t,n){return e["delete"](t,t.prev(n))},e.pop=function(t){return e.deleteBefore(t,null)},e.shift=function(t){return e.deleteAfter(t,null)},e.remove=function(t,n){var r=e.idOf(t,n);return null==r?!1:(delete r,!0)},e}(i.ObservableList);n.MutableList=u,n["default"]=u},{"./observable_list":8}],7:[function(t,e,n){var r=t("./id"),i=function(){function t(){var t=this;this.observe=function(e){var n=r["default"].create();return t._observers[n]=e,{unsubscribe:function(){delete t._observers[n]}}},this.notify=function(e){for(var n in t._observers)e(t._observers[n])},this._observers=Object.create(null)}return t}();n.Subject=i},{"./id":3}],8:[function(t,e,n){var r=this.__extends||function(t,e){function n(){this.constructor=t}for(var r in e)e.hasOwnProperty(r)&&(t[r]=e[r]);n.prototype=e.prototype,t.prototype=new n},i=t("./list"),u=t("./tree"),o=t("./observable"),l=function(t){function e(n){var r=this;t.call(this,n),this.observe=function(t){throw new Error("Not implemented")},this.reverse=function(){return e.create(e.reverse(r))},this.map=function(t){return e.create(e.map(r,t))},this.filter=function(t){return e.create(e.filter(r,t))},this.flatten=function(){return e.create(e.flatten(r))},this.flatMap=function(t){return e.create(e.flatMap(r,t))},this.cache=function(){return e.create(e.cache(r))},null!=n&&(this.observe=n.observe)}return r(e,t),e.isObservableList=function(t){return i.List.isList(t)&&!!t.observe},e.create=function(t){return new e({has:t.has.bind(t),get:t.get.bind(t),prev:t.prev.bind(t),next:t.next.bind(t),observe:t.observe.bind(t)})},e.reverse=function(t){function e(e){return t.observe(e)}var n=i.List.reverse(t),r=n.has,u=n.get,o=n.prev,l=n.next;return{has:r,get:u,prev:o,next:l,observe:e}},e.map=function(t,e){var n=i.List.map(t,e),r=n.has,u=n.get,o=n.prev,l=n.next;return{has:r,get:u,prev:o,next:l,observe:t.observe}},e.filter=function(t,e){function n(e){return t.observe({onInvalidate:function(t,n){t=u(t)?t:l(t),n=u(n)?n:a(n),e.onInvalidate(t,n)}})}var r=i.List.filter(t,e),u=r.has,o=r.get,l=r.prev,a=r.next;return{has:u,get:o,prev:l,next:a,observe:n}},e.flatten=function(t){var n,r=Object.create(null),l=new o.Subject;t.observe({onInvalidate:function(t,e){var i;for(i=t;null!=(i=n.next(i))&&i!=e;){var u=r[i];u&&(u.unsubscribe(),delete r[i])}for(i=e;null!=(i=n.prev(i))&&i!=t;){var u=r[i];u&&(u.unsubscribe(),delete r[i])}}}),n=e.cache(e.map(t,function(e,n){return r[n]=e.observe({onInvalidate:function(e,r){var i,o,a=u.Path.append(n,e),s=u.Path.append(n,r);null==e&&(a=u.Tree.prev(t,u.Tree.next(t,a))),null==r&&(s=u.Tree.next(t,u.Tree.prev(t,s))),i=u.Path.id(a),o=u.Path.id(s),l.notify(function(t){t.onInvalidate(i,o)})}}),e})),n.observe({onInvalidate:function(e,n){var r=u.Path.id(u.Tree.prev(t,[e])),i=u.Path.id(u.Tree.next(t,[n]));l.notify(function(t){t.onInvalidate(r,i)})}});var a=i.List.flatten(n),s=a.has,f=a.get,c=a.next,h=a.prev;return{has:s,get:f,next:c,prev:h,observe:l.observe}},e.flatMap=function(t,n){return e.flatten(e.map(t,n))},e.cache=function(t){function e(e){return e in u||t.has(e)}function n(e){return e in u?u[e]:t.has(e)?u[e]=t.get(e):void 0}function r(e){if(e in l)return l[e];var n=t.prev(e);return null!=n&&(l[e]=n,o[n]=e),n}function i(e){if(e in o)return o[e];var n=t.next(e);return null!=n&&(o[e]=n,l[n]=e),n}var u=Object.create(null),o=Object.create(null),l=Object.create(null);return t.observe({onInvalidate:function(t,e){var n;for(n=t;null!=(n=o[n])&&(delete o[l[n]],delete l[n],n!=e);)delete u[n];for(;null!=(n=l[n])&&(delete l[o[n]],delete o[n],n!=t);)delete u[n]}}),{has:e,get:n,prev:r,next:i,observe:t.observe}},e}(i.List);n.ObservableList=l,n["default"]=l},{"./list":5,"./observable":7,"./tree":9}],9:[function(t,e,n){var r,i=t("./list");!function(t){function e(t){return JSON.stringify(t)}function n(t){return null==t?null:JSON.parse(t.toString())}function r(t){return t?t[0]:null}function i(t,e){return t[e]}function u(t){return null==t?[]:t.slice(1,t.length)}function o(t,e){return[].concat(t).concat(e)}t.id=e,t.create=n,t.head=r,t.get=i,t.tail=u,t.append=o}(r=n.Path||(n.Path={}));var u;!function(t){function e(e,n,i){void 0===i&&(i=1/0);var u=r.head(n),o=r.tail(n);return e.has(u)&&(0==o.length||0==i||t.has(e.get(u),o,i))}function n(e,n,i){void 0===i&&(i=1/0);var u=r.head(n),o=r.tail(n);if(e.has(u)){var l=e.get(u);return 0==o.length||0==i?l:t.get(l,o,i)}}function u(e,n,u){void 0===n&&(n=[]),void 0===u&&(u=1/0);var o,l=r.head(n),a=r.tail(n),s=l;if(null==l||e.has(l))do if(o=e.get(s),i.List.isList(o)&&0!=u){var f=t.prev(o,a,u-1);if(null!=f)return r.append(s,f);a=[]}else if(null!=s&&s!=l)return[s];while(null!=(s=e.prev(s)))}function o(e,n,u){void 0===n&&(n=[]),void 0===u&&(u=1/0);var o,l=r.head(n),a=r.tail(n),s=l;if(null==l||e.has(l))do if(o=e.get(s),i.List.isList(o)&&0!=u){var f=t.next(o,a,u-1);if(null!=f)return r.append(s,f);a=[]}else if(null!=s&&s!=l)return[s];while(null!=(s=e.next(s)))}t.has=e,t.get=n,t.prev=u,t.next=o}(u=n.Tree||(n.Tree={})),n["default"]=u},{"./list":5}],10:[function(t,e,n){var r=this.__extends||function(t,e){function n(){this.constructor=t}for(var r in e)e.hasOwnProperty(r)&&(t[r]=e[r]);n.prototype=e.prototype,t.prototype=new n},i=t("./id"),u=t("./observable"),o=t("./mutable_list"),l=function(t){function e(e){var n=this;t.call(this),this.has=function(t){return n._id==t},this.get=function(t){return n.has(t)?n._value:void 0},this.prev=function(t){return null==t?n._id:null},this.next=function(t){return null==t?n._id:null},this.set=function(t,e){return n._id=t,n._value=e,n._invalidate(),t},this.splice=function(t,e){for(var r=[],u=2;u<arguments.length;u++)r[u-2]=arguments[u];r.length&&n.set(i["default"].create(),r[0])},this.observe=function(t){return n._subject.observe(t)},this._invalidate=function(t,e){n._subject.notify(function(n){n.onInvalidate(t,e)})},this._subject=new u.Subject,arguments.length&&this.splice(null,null,e)}return r(e,t),e}(o["default"]);n.Unit=l,n["default"]=l},{"./id":3,"./mutable_list":6,"./observable":7}],11:[function(t,e,n){function r(t){return i["default"](t)}var r,i=t("./factory"),u=t("./list"),o=t("./observable_list"),l=t("./mutable_list"),a=t("./unit"),s=t("./array_list"),f=t("./linked_list"),c=t("./tree");!function(t){t.List=u["default"],t.ObservableList=o["default"],t.MutableList=l["default"],t.Unit=a["default"],t.ArrayList=s["default"],t.LinkedList=f["default"],t.Tree=c["default"]}(r||(r={})),e.exports=r},{"./array_list":1,"./factory":2,"./linked_list":4,"./list":5,"./mutable_list":6,"./observable_list":8,"./tree":9,"./unit":10}]},{},[11])(11)});