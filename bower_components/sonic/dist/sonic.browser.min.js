!function(a){if("object"==typeof exports&&"undefined"!=typeof module)module.exports=a();else if("function"==typeof define&&define.amd)define([],a);else{var b;b="undefined"!=typeof window?window:"undefined"!=typeof global?global:"undefined"!=typeof self?self:this,b.Sonic=a()}}(function(){return function a(b,c,d){function e(g,h){if(!c[g]){if(!b[g]){var i="function"==typeof require&&require;if(!h&&i)return i(g,!0);if(f)return f(g,!0);var j=new Error("Cannot find module '"+g+"'");throw j.code="MODULE_NOT_FOUND",j}var k=c[g]={exports:{}};b[g][0].call(k.exports,function(a){var c=b[g][1][a];return e(c?c:a)},k,k.exports,a,b,c,d)}return c[g].exports}for(var f="function"==typeof require&&require,g=0;g<d.length;g++)e(d[g]);return e}({1:[function(a,b){(function(){var c,d;d=a("./unique_id"),c=function(){function a(){this._byId={},this._prev={},this._next={},this._handlers={}}return a.prototype.get=function(a){return this._byId[a]},a.prototype.has=function(a){return!!a&&a in this._byId},a.prototype.prev=function(a){return null==a&&(a=0),this._prev[a]||null},a.prototype.next=function(a){return null==a&&(a=0),this._next[a]||null},a.prototype.onInvalidate=function(a){var b;return b=d(),this._handlers[b]=a,b},a.prototype.removeListener=function(a){return this._handlers[a]?(delete this._handlers[a],!0):!1},a.prototype._splice=function(a,b,c,d){var e,f;if(null==d&&(d=c),0!==a&&!this.has(a)&&0!==b&&!this.has(b))return!1;for(;(e=this._next[e||a])&&(delete this._next[this._prev[e]],delete this._prev[e],e!==b);)delete this._byId[e];for(;(f=this._prev[f||b])&&(delete this._prev[this._next[f]],delete this._next[f],f!==a);)delete this._byId[f];return null!=c&&null!=a&&(this._next[a]=c,this._prev[c]=a),null!=d&&null!=b&&(this._prev[b]=d,this._next[d]=b),this._invalidate(a,b),!0},a.prototype._add=function(a,b,c){var e;return e=d(),null!=c&&null==b&&(b=this._prev[c]),null!=b&&null==c&&(c=this._next[b]),this._splice(b,c,e)?(this._byId[e]=a,e):null},a.prototype._set=function(a,b){return this.has(a)?(this._byId[a]=b,this._invalidate(this._prev[a],this._next[a]),!0):!1},a.prototype._delete=function(a){return 0!==a&&this._splice(this._prev[a],this._next[a],this._next[a],this._prev[a])},a.prototype._move=function(a,b,c){var d,e;return null!=(e=this._prev[a])&&this._splice(e,a),null!=(d=this._next[a])&&this._splice(a,d),this._splice(e,d,d,e),null!=c&&null==b&&(b=this._prev[c]),null!=b&&null==c&&(c=this._next[b]),this._splice(b,c,a)},a.prototype._invalidate=function(a,b){var c,d,e,f;null==a&&(a=0),null==b&&(b=0),e=this._handlers,f=[];for(d in e)c=e[d],f.push(c(a,b)===!1?delete this._handlers[d]:void 0);return f},a}(),b.exports=c}).call(this)},{"./unique_id":9}],2:[function(a,b){(function(){var c,d,e,f;c=a("./abstract_list"),d=a("./list"),e=a("./unit"),f=function(a){return a instanceof c?a:Array.isArray(a)?new d(a):arguments.length?new e(a):new e},b.exports=f}).call(this)},{"./abstract_list":1,"./list":6,"./unit":10}],3:[function(a,b){(function(){var c,d,e,f,g=function(a,b){return function(){return a.apply(b,arguments)}},h={}.hasOwnProperty,i=function(a,b){function c(){this.constructor=a}for(var d in b)h.call(b,d)&&(a[d]=b[d]);return c.prototype=b.prototype,a.prototype=new c,a.__super__=b.prototype,a};f=a("./factory"),c=a("./abstract_list"),e=a("./unit"),d=function(a){function b(a,c){this._onFlatMapFnInvalidate=g(this._onFlatMapFnInvalidate,this),this._onListInvalidate=g(this._onListInvalidate,this),this._onSourceInvalidate=g(this._onSourceInvalidate,this),b.__super__.constructor.call(this),this._sourceIdById={},this._listBySourceId={},this._source=f(a),this._source.onInvalidate(this._onSourceInvalidate),this._flatMapFn=f(c||function(a){return new e(a)}),this._flatMapFn.onInvalidate(this._onFlatMapFnInvalidate)}return i(b,a),b.prototype.get=function(a){var b;return(b=this._getListById(a))?b.get(a):void 0},b.prototype.has=function(a){return!!a&&a in this._sourceIdById},b.prototype.prev=function(a){var b,c,d;if(null==a&&(a=0),d=a?this._sourceIdById[a]:this._source.prev(),!d)return null;for(b=this._getListBySourceId(d),c=b.prev(a);!c;){if(!(d=this._source.prev(d)))return null;b=this._getListBySourceId(d),c=b.prev()}return this._sourceIdById[c]=d,c},b.prototype.next=function(a){var b,c,d;if(null==a&&(a=0),d=a?this._sourceIdById[a]:this._source.next(),!d)return null;for(b=this._getListBySourceId(d),c=b.next(a);!c;){if(!(d=this._source.next(d)))return null;b=this._getListBySourceId(d),c=b.next()}return this._sourceIdById[c]=d,c},b.prototype._getListBySourceId=function(a){var b;if(b=this._listBySourceId[a])return b;if(this._source.has(a))return b=this._flatMapFn.last()(this._source.get(a)),b.onInvalidate(function(b){return function(c,d){return b._onListInvalidate(a,c,d)}}(this)),this._listBySourceId[a]=b,b},b.prototype._getListById=function(a){return this._getListBySourceId(this._sourceIdById[a])},b.prototype._onSourceInvalidate=function(a,b){for(var c,d,e,f;(a=this._source.prev(a))&&!(f=this._listBySourceId[a]););for(e=(null!=f?f.prev():void 0)||0;(b=this._source.next(b))&&!(d=this._listBySourceId[b]););return c=(null!=d?d.next():void 0)||0,this._invalidate(e,c),!0},b.prototype._onListInvalidate=function(a,b,c){var d,e,f;return(d=this._listBySourceId[a])?(b||(b=(null!=(e=this._getListBySourceId(this._source.prev(a)))?e.prev():void 0)||0),c||(c=(null!=(f=this._getListBySourceId(this._source.next(a)))?f.next():void 0)||0),this._invalidate(b,c),!0):!1},b.prototype._onFlatMapFnInvalidate=function(a,b){return b||this._invalidate(),!0},b.prototype._invalidate=function(a,c){var d,e;for(null==a&&(a=0),null==c&&(c=0),e=this._sourceIdById[a],d=this._sourceIdById[c];(e=this._source.next(e))&&e!==d;)delete this._listBySourceId[e];for(;(d=this._source.next(d))&&d!==e;)delete this._listBySourceId[d];return b.__super__._invalidate.call(this,a,c)},b}(c),b.exports=d}).call(this)},{"./abstract_list":1,"./factory":2,"./unit":10}],4:[function(a,b){(function(){var c,d,e,f={}.hasOwnProperty,g=function(a,b){function c(){this.constructor=a}for(var d in b)f.call(b,d)&&(a[d]=b[d]);return c.prototype=b.prototype,a.prototype=new c,a.__super__=b.prototype,a};a("es6-collections"),c=a("./flat_map_list"),e=a("./unit"),d=function(a){function b(a,c){var d;console.log(JSON.stringify(Object.keys(Map))),this._byValue=new Map,this._groupFn=c||function(a){return a},d=function(a){var b,c;return b=this._groupFn(a),this._byValue.has(b)?new e:(c=this._source.filter(function(a){return function(c){return a._groupFn(c)===b}}(this)),this._byValue.set(b,c),new e(c))},b.__super__.constructor.call(this,a,d)}return g(b,a),b}(c),b.exports=d}).call(this)},{"./flat_map_list":3,"./unit":10,"es6-collections":11}],5:[function(a,b){(function(){var a;a=function(){function a(a,b){this.list=a,this.currentId=this.startId=b}return a.prototype.current=function(){return this.list.get(this.currentId)},a.prototype.reset=function(){return this.currentId=this.startId,this},a.prototype.moveNext=function(){return this.currentId=this.list.next(this.currentId),!!this.currentId},a.prototype.movePrevious=function(){return this.currentId=this.list.prev(this.currentId),!!this.currentId},a.prototype.next=function(){return this.moveNext()?{value:this.current(),done:!1,id:this.currentId}:{done:!0,id:this.currentId}},a.prototype.previous=function(){return this.movePrevious()?{value:this.current(),done:!1,id:this.currentId}:{done:!0,id:this.currentId}},a}(),b.exports=a}).call(this)},{}],6:[function(a,b){(function(){var c,d,e={}.hasOwnProperty,f=function(a,b){function c(){this.constructor=a}for(var d in b)e.call(b,d)&&(a[d]=b[d]);return c.prototype=b.prototype,a.prototype=new c,a.__super__=b.prototype,a};c=a("./abstract_list"),d=function(a){function b(a){var c,d,e;if(b.__super__.constructor.call(this),this._splice(0,0,0),null!=a)for(d=0,e=a.length;e>d;d++)c=a[d],this._add(c,null,0)}return f(b,a),b.prototype.set=function(a,b){return this._set(a,b)},b.prototype.push=function(a){return this._add(a,null,0)},b.prototype.unshift=function(a){return this._add(a,0)},b.prototype.pop=function(){var a,b;return a=this.prev(),b=this.get(a),this._delete(a)?b:void 0},b.prototype.shift=function(){var a,b;return a=this.next(),b=this.get(a),this._delete(a)?b:void 0},b.prototype.remove=function(a){var b;return b=this.idOf(a),this._delete(b)},b.prototype["delete"]=function(a){return this._delete(a)},b}(c),b.exports=d}).call(this)},{"./abstract_list":1}],7:[function(a,b){(function(){var c,d,e,f,g,h,i,j,k,l,m,n=[].slice;k=a("./factory"),m=a("./unique_id"),f=a("./iterator"),c=a("./abstract_list"),g=a("./list"),j=a("./unit"),d=a("./flat_map_list"),e=a("./group_list"),i=a("./take_list"),h=k,h.unit=function(a){return new j(a)},h.empty=function(){return new j},h.getIterator=function(a,b){return a=h(a),new f(a,b)},h.each=function(a,b){return a=h(a),h.forEach(a,b)},h.forEach=function(a,b){var c;for(a=h(a),c=h.getIterator(a);c.moveNext();)if(b(c.current(),c.currentId)===!1)return!1;return!0},h.findId=function(a,b){var c;return a=h(a),c=void 0,h.each(a,function(a,d){return b(a)?(c=d,!1):void 0}),c},h.find=function(a,b){return a=h(a),a.get(h.findId(a,b))},h.idAt=function(a,b){var c;return a=h(a),c=0,h.findId(a,function(){return c++===b?!0:void 0})},h.idOf=function(a,b){return a=h(a),h.findId(a,function(a){return a===b})},h.at=function(a,b){return a=h(a),a.get(h.idAt(a,b))},h.indexOf=function(a,b){var c;return a=h(a),c=-1,h.some(a,function(a){return c++,a===b})?c:-1},h.some=function(a,b){return a=h(a),!h.each(a,function(){return!b.apply(null,arguments)})},h.any=function(a,b){return a=h(a),h.some(a,b)},h.contains=function(a,b){return a=h(a),h.some(a,function(a){return a===b})},h.first=function(a){return a=h(a),a.get(a.next())},h.last=function(a){return a=h(a),a.get(a.prev())},h.reduce=function(a,b,c){return a=h(a),h.each(a,function(a,d){return b(c,a,d)}),c},h.flatMap=function(a,b){return a=h(a),new d(a,b)},h.group=function(a,b){return a=h(a),new e(a,b)},h.sort=function(a,b){return a=h(a),new SortedList(a,{sortFn:b})},h.take=function(a,b){return a=h(a),new i(a,b)},h.map=function(a,b){return a=h(a),h.flatMap(a,function(a){return new j(b(a))})},h.pluck=function(a,b){return a=h(a),h.map(a,function(a){return a[b]})},h.invoke=function(){var a,b,c;return c=arguments[0],b=arguments[1],a=3<=arguments.length?n.call(arguments,2):[],c=h(c),h.map(c,function(c){return c[b].apply(c,a)})},h.filter=function(a,b){return a=h(a),h.flatMap(a,function(a){return b(a)?new j(a):new j})},h.concat=function(){var a,b;return b=1<=arguments.length?n.call(arguments,0):[],a=h(a),h.flatMap(b,function(a){return a})},h.flatten=function(a){return a=h(a),h.flatMap(a,function(a){return a})},h.uniq=function(a,b){return null==b&&(b=function(a){return a}),a=h(a),h.flatMap(h.group(a,b),function(a){return a.take(1)})},h.union=function(){var a,b;return b=1<=arguments.length?n.call(arguments,0):[],a=h(a),h.concat.apply(h,b).uniq()},h.intersection=function(a,b){return a=h(a),h.filter(a,b.contains)},h.proxy=function(a,b){var d,e,f;null==b&&(b={get:"get",has:"has",prev:"prev",next:"next",onInvalidate:"onInvalidate"}),a=h(a),f=new c;for(e in b)d=b[e],f[e]=a[d].bind(a);return f},h.reverse=function(a){var b,c;return a=h(a),b={get:"get",has:"has",prev:"next",next:"prev"},c=h.proxy(a,b),c.onInvalidate=function(b){return a.onInvalidate(function(a){return b({prev:a.next,next:a.prev})})},c},h.toArray=function(a){return a=h(a),h.reduce(a,function(a,b){return a.push(b)},[])},h.uniqueId=m,h.Iterator=f,h.AbstractList=c,h.Unit=j,h.List=g,h.FlatMapList=d,h.GroupList=e,h.TakeList=i,l=["getIterator","each","forEach","at","idAt","idOf","indexOf","contains","any","some","find","reduce","first","last","toArray","flatMap","group","sort","take","map","pluck","invoke","filter","concat","flatten","uniq","union","intersection","proxy","reverse"],l.forEach(function(a){return c.prototype[a]=function(){return h[a].apply(h,[this].concat(n.call(arguments)))}}),b.exports=h}).call(this)},{"./abstract_list":1,"./factory":2,"./flat_map_list":3,"./group_list":4,"./iterator":5,"./list":6,"./take_list":8,"./unique_id":9,"./unit":10}],8:[function(a,b){(function(){var c,d,e={}.hasOwnProperty,f=function(a,b){function c(){this.constructor=a}for(var d in b)e.call(b,d)&&(a[d]=b[d]);return c.prototype=b.prototype,a.prototype=new c,a.__super__=b.prototype,a};c=a("./abstract_list"),d=function(a){function b(a,c){this._indexById={0:0},this._source=a,this._count=c,b.__super__.constructor.call(this),this._source.onInvalidate(function(a){return function(b){return a._invalidate(b.prev)}}(this)),this.onInvalidate(function(a){return function(b){var c,d;for(d=[];c=a._source.next(c||b.prev);)d.push(delete a._indexById[c]);return d}}(this))}return f(b,a),b.prototype.get=function(a){return this._source.get(a)},b.prototype.has=function(a){return this._source.has(a)},b.prototype.prev=function(a){null==a&&(a=0)},b.prototype.next=function(a){var b,c,d;if(null==a&&(a=0),null==(b=this._indexById[a])){for(;(d=this._source.prev(d||a))&&!(b=this._indexById[a]););for(;(c=this._source.next(c||d))&&(this._indexById[c]=b++,c!==a););}return b>=this._count?void 0:(c=this._source.next(c||a),this._indexById[c]=++b,c)},b}(c),b.exports=d}).call(this)},{"./abstract_list":1}],9:[function(a,b){(function(){var a;a=1,b.exports=function(){return a++}}).call(this)},{}],10:[function(a,b){(function(){var c,d,e={}.hasOwnProperty,f=function(a,b){function c(){this.constructor=a}for(var d in b)e.call(b,d)&&(a[d]=b[d]);return c.prototype=b.prototype,a.prototype=new c,a.__super__=b.prototype,a};c=a("./list"),d=function(a){function b(a){var c;c=arguments.length?[a]:[],b.__super__.constructor.call(this,c)}return f(b,a),b.prototype.push=function(a){return this._add(a,0,0)},b.prototype.unshift=function(a){return this.push(a)},b.prototype.pop=function(){var a;return a=this.last(),this._splice(0,0),a},b.prototype.shift=function(){return this.pop()},b}(c),b.exports=d}).call(this)},{"./list":6}],11:[function(a,b,c){(function(a){!function(a){"use strict";function b(a,b){function d(a){return this&&this.constructor===d?(this._keys=[],this._values=[],this.objectOnly=b,void(a&&c.call(this,a))):new d(a)}return b||u(a,"size",{get:q}),a.constructor=d,d.prototype=a,d}function c(a){this.add?a.forEach(this.add,this):a.forEach(function(a){this.set(a[0],a[1])},this)}function d(a){return this.has(a)&&(this._keys.splice(t,1),this._values.splice(t,1)),t>-1}function e(a){return this.has(a)?this._values[t]:void 0}function f(a,b){if(this.objectOnly&&b!==Object(b))throw new TypeError("Invalid value used as weak collection key");if(b!=b||0===b)for(t=a.length;t--&&!v(a[t],b););else t=a.indexOf(b);return t>-1}function g(a){return f.call(this,this._values,a)}function h(a){return f.call(this,this._keys,a)}function i(a,b){return this.has(a)?this._values[t]=b:this._values[this._keys.push(a)-1]=b,this}function j(a){return this.has(a)||this._values.push(a),this}function k(){this._values.length=0}function l(){return p(this._keys)}function m(){return p(this._values)}function n(){return p(this._keys,this._values)}function o(){return p(this._values,this._values)}function p(a,b){var c=0,d=!1;return{next:function(){var e;return!d&&c<a.length?(e=b?[a[c],b[c]]:a[c],c+=1):d=!0,{done:d,value:e}}}}function q(){return this._values.length}function r(a,b){var c=this,d=c._values.slice();c._keys.slice().forEach(function(e,f){a.call(b,d[f],e,c)})}function s(a,b){var c=this;c._values.slice().forEach(function(d){a.call(b,d,d,c)})}var t,u=Object.defineProperty,v=function(a,b){return isNaN(a)?isNaN(b):a===b};"undefined"==typeof WeakMap&&(a.WeakMap=b({"delete":d,clear:k,get:e,has:h,set:i},!0)),"undefined"==typeof Map&&(a.Map=b({"delete":d,has:h,get:e,set:i,keys:l,values:m,entries:n,forEach:r,clear:k})),"undefined"==typeof Set&&(a.Set=b({has:g,add:j,"delete":d,clear:k,keys:m,values:m,entries:o,forEach:s})),"undefined"==typeof WeakSet&&(a.WeakSet=b({"delete":d,add:j,clear:k,has:g},!0))}("undefined"!=typeof c&&"undefined"!=typeof a?a:window)}).call(this,"undefined"!=typeof global?global:"undefined"!=typeof self?self:"undefined"!=typeof window?window:{})},{}]},{},[7])(7)});